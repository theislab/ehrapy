<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <meta name="generator" content="sphinx-5.1.1, furo 2022.06.21"/>
        <title>ehrapy.plot._scanpy_pl_api - ehrapy</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=40978830699223671f4072448e654b5958f38b89" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/override.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/sphinx_gallery.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #003262;
  --color-brand-content: #003262;
  --admonition-font-size: var(--font-size-normal);
  --admonition-title-font-size: var(--font-size-normal);
  --code-font-size: var(--font-size--small);
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">ehrapy</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/ehrapy_pure.png" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../usage/usage.html">Usage</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/io/ehrapy.io.read_csv.html">ehrapy.io.read_csv</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/io/ehrapy.io.read_h5ad.html">ehrapy.io.read_h5ad</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/io/ehrapy.io.read_pdf.html">ehrapy.io.read_pdf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/io/ehrapy.io.write.html">ehrapy.io.write</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.mimic_2.html">ehrapy.data.mimic_2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.mimic_3_demo.html">ehrapy.data.mimic_3_demo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.diabetes_130.html">ehrapy.data.diabetes_130</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.heart_failure.html">ehrapy.data.heart_failure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.chronic_kidney_disease.html">ehrapy.data.chronic_kidney_disease</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.breast_tissue.html">ehrapy.data.breast_tissue</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.cervical_cancer_risk_factors.html">ehrapy.data.cervical_cancer_risk_factors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.dermatology.html">ehrapy.data.dermatology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.echocardiogram.html">ehrapy.data.echocardiogram</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.heart_disease.html">ehrapy.data.heart_disease</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.hepatitis.html">ehrapy.data.hepatitis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.statlog_heart.html">ehrapy.data.statlog_heart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.thyroid.html">ehrapy.data.thyroid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.breast_cancer_coimbra.html">ehrapy.data.breast_cancer_coimbra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.parkinson_dataset_with_replicated_acoustic_features.html">ehrapy.data.parkinson_dataset_with_replicated_acoustic_features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.parkinsons.html">ehrapy.data.parkinsons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.parkinsons_disease_classification.html">ehrapy.data.parkinsons_disease_classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/data/ehrapy.data.parkinsons_telemonitoring.html">ehrapy.data.parkinsons_telemonitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.pca.html">ehrapy.preprocessing.pca</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.regress_out.html">ehrapy.preprocessing.regress_out</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.subsample.html">ehrapy.preprocessing.subsample</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.highly_variable_features.html">ehrapy.preprocessing.highly_variable_features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.qc_metrics.html">ehrapy.preprocessing.qc_metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.qc_lab_measurements.html">ehrapy.preprocessing.qc_lab_measurements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/imputation/ehrapy.preprocessing.explicit_impute.html">ehrapy.preprocessing.explicit_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/imputation/ehrapy.preprocessing.simple_impute.html">ehrapy.preprocessing.simple_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/imputation/ehrapy.preprocessing.knn_impute.html">ehrapy.preprocessing.knn_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/imputation/ehrapy.preprocessing.miss_forest_impute.html">ehrapy.preprocessing.miss_forest_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/imputation/ehrapy.preprocessing.soft_impute.html">ehrapy.preprocessing.soft_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/imputation/ehrapy.preprocessing.iterative_svd_impute.html">ehrapy.preprocessing.iterative_svd_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/imputation/ehrapy.preprocessing.matrix_factorization_impute.html">ehrapy.preprocessing.matrix_factorization_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/imputation/ehrapy.preprocessing.nuclear_norm_minimization_impute.html">ehrapy.preprocessing.nuclear_norm_minimization_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/imputation/ehrapy.preprocessing.mice_forest_impute.html">ehrapy.preprocessing.mice_forest_impute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.encode.html">ehrapy.preprocessing.encode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.undo_encoding.html">ehrapy.preprocessing.undo_encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.log_norm.html">ehrapy.preprocessing.log_norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.maxabs_norm.html">ehrapy.preprocessing.maxabs_norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.minmax_norm.html">ehrapy.preprocessing.minmax_norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.power_norm.html">ehrapy.preprocessing.power_norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.quantile_norm.html">ehrapy.preprocessing.quantile_norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.robust_scale_norm.html">ehrapy.preprocessing.robust_scale_norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.scale_norm.html">ehrapy.preprocessing.scale_norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.sqrt_norm.html">ehrapy.preprocessing.sqrt_norm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.combat.html">ehrapy.preprocessing.combat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/preprocessing/ehrapy.preprocessing.neighbors.html">ehrapy.preprocessing.neighbors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.pca.html">ehrapy.tools.pca</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.tsne.html">ehrapy.tools.tsne</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.umap.html">ehrapy.tools.umap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.draw_graph.html">ehrapy.tools.draw_graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.diffmap.html">ehrapy.tools.diffmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.embedding_density.html">ehrapy.tools.embedding_density</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.leiden.html">ehrapy.tools.leiden</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.louvain.html">ehrapy.tools.louvain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.dendrogram.html">ehrapy.tools.dendrogram</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.dpt.html">ehrapy.tools.dpt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.paga.html">ehrapy.tools.paga</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.rank_features_groups.html">ehrapy.tools.rank_features_groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.filter_rank_features_groups.html">ehrapy.tools.filter_rank_features_groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.marker_feature_overlap.html">ehrapy.tools.marker_feature_overlap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.ingest.html">ehrapy.tools.ingest</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.Translator.html">ehrapy.tools.Translator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.HPOMapper.html">ehrapy.tools.HPOMapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.MedCAT.html">ehrapy.tools.MedCAT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.mc.run_unsupervised_training.html">ehrapy.tools.mc.run_unsupervised_training</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.mc.annotate_text.html">ehrapy.tools.mc.annotate_text</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.mc.get_annotation_overview.html">ehrapy.tools.mc.get_annotation_overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.ols.html">ehrapy.tools.ols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.glm.html">ehrapy.tools.glm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.tools.kmf.html">ehrapy.tools.kmf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.scatter.html">ehrapy.plot.scatter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.heatmap.html">ehrapy.plot.heatmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.dotplot.html">ehrapy.plot.dotplot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.tracksplot.html">ehrapy.plot.tracksplot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.violin.html">ehrapy.plot.violin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.stacked_violin.html">ehrapy.plot.stacked_violin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.matrixplot.html">ehrapy.plot.matrixplot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.clustermap.html">ehrapy.plot.clustermap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.ranking.html">ehrapy.plot.ranking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.dendrogram.html">ehrapy.plot.dendrogram</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.qc_metrics.html">ehrapy.plot.qc_metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.pca.html">ehrapy.plot.pca</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.pca_loadings.html">ehrapy.plot.pca_loadings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.pca_variance_ratio.html">ehrapy.plot.pca_variance_ratio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.pca_overview.html">ehrapy.plot.pca_overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.tsne.html">ehrapy.plot.tsne</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.umap.html">ehrapy.plot.umap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.diffmap.html">ehrapy.plot.diffmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.draw_graph.html">ehrapy.plot.draw_graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.spatial.html">ehrapy.plot.spatial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.embedding.html">ehrapy.plot.embedding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.embedding_density.html">ehrapy.plot.embedding_density</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.dpt_groups_pseudotime.html">ehrapy.plot.dpt_groups_pseudotime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.dpt_timeseries.html">ehrapy.plot.dpt_timeseries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.paga.html">ehrapy.plot.paga</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.paga_path.html">ehrapy.plot.paga_path</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.paga_compare.html">ehrapy.plot.paga_compare</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.rank_features_groups.html">ehrapy.plot.rank_features_groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.rank_features_groups_violin.html">ehrapy.plot.rank_features_groups_violin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.rank_features_groups_stacked_violin.html">ehrapy.plot.rank_features_groups_stacked_violin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.rank_features_groups_heatmap.html">ehrapy.plot.rank_features_groups_heatmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.rank_features_groups_dotplot.html">ehrapy.plot.rank_features_groups_dotplot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.rank_features_groups_matrixplot.html">ehrapy.plot.rank_features_groups_matrixplot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/plot/ehrapy.plot.rank_features_groups_tracksplot.html">ehrapy.plot.rank_features_groups_tracksplot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.plot.ols.html">ehrapy.plot.ols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/tools/ehrapy.plot.kmf.html">ehrapy.plot.kmf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/anndata/ehrapy.anndata.df_to_anndata.html">ehrapy.anndata.df_to_anndata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/anndata/ehrapy.anndata.anndata_to_df.html">ehrapy.anndata.anndata_to_df</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/anndata/ehrapy.anndata.move_to_obs.html">ehrapy.anndata.move_to_obs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/anndata/ehrapy.anndata.move_to_x.html">ehrapy.anndata.move_to_x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../usage/anndata/ehrapy.anndata.type_overview.html">ehrapy.anndata.type_overview</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/notebooks/ehrapy_introduction.html">Introduction to ehrapy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/notebooks/mimic_2_introduction.html">MIMIC-II IAC Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/notebooks/mimic_2_fate.html">MIMIC-II Patient Fate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/notebooks/mimic_2_survival_analysis.html">MIMIC-II Survival Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/notebooks/diabetes_130.html">Diabetes 130 Vignette</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/notebooks/medcat.html">Extracting from free text with MedCAT</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/theislab/ehrapy/discussions">Discussions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../references.html">References</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for ehrapy.plot._scanpy_pl_api</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">MappingProxyType</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Collection</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scanpy</span> <span class="k">as</span> <span class="nn">sc</span>
<span class="kn">from</span> <span class="nn">anndata</span> <span class="kn">import</span> <span class="n">AnnData</span>
<span class="kn">from</span> <span class="nn">cycler</span> <span class="kn">import</span> <span class="n">Cycler</span>
<span class="kn">from</span> <span class="nn">matplotlib.axes</span> <span class="kn">import</span> <span class="n">Axes</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">Colormap</span><span class="p">,</span> <span class="n">ListedColormap</span><span class="p">,</span> <span class="n">Normalize</span>
<span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="kn">import</span> <span class="n">Figure</span>
<span class="kn">from</span> <span class="nn">scanpy.plotting</span> <span class="kn">import</span> <span class="n">DotPlot</span><span class="p">,</span> <span class="n">MatrixPlot</span><span class="p">,</span> <span class="n">StackedViolin</span>
<span class="kn">from</span> <span class="nn">scanpy.plotting._tools.scatterplots</span> <span class="kn">import</span> <span class="n">_wraps_plot_scatter</span>
<span class="kn">from</span> <span class="nn">scanpy.plotting._utils</span> <span class="kn">import</span> <span class="n">_AxesSubplot</span>

<span class="kn">from</span> <span class="nn">ehrapy.tools.nlp._medcat</span> <span class="kn">import</span> <span class="n">EhrapyMedcat</span><span class="p">,</span> <span class="n">MedCAT</span>
<span class="kn">from</span> <span class="nn">ehrapy.util._doc_util</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">_doc_params</span><span class="p">,</span>
    <span class="n">doc_adata_color_etc</span><span class="p">,</span>
    <span class="n">doc_common_groupby_plot_args</span><span class="p">,</span>
    <span class="n">doc_common_plot_args</span><span class="p">,</span>
    <span class="n">doc_edges_arrows</span><span class="p">,</span>
    <span class="n">doc_panels</span><span class="p">,</span>
    <span class="n">doc_scatter_basic</span><span class="p">,</span>
    <span class="n">doc_scatter_embedding</span><span class="p">,</span>
    <span class="n">doc_scatter_spatial</span><span class="p">,</span>
    <span class="n">doc_show_save_ax</span><span class="p">,</span>
    <span class="n">doc_vbound_percentile</span><span class="p">,</span>
    <span class="n">doc_vboundnorm</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">_Basis</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;pca&quot;</span><span class="p">,</span> <span class="s2">&quot;tsne&quot;</span><span class="p">,</span> <span class="s2">&quot;umap&quot;</span><span class="p">,</span> <span class="s2">&quot;diffmap&quot;</span><span class="p">,</span> <span class="s2">&quot;draw_graph_fr&quot;</span><span class="p">]</span>
<span class="n">_VarNames</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
<span class="n">ColorLike</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span>
<span class="n">_IGraphLayout</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fa&quot;</span><span class="p">,</span> <span class="s2">&quot;fr&quot;</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">,</span> <span class="s2">&quot;rt_circular&quot;</span><span class="p">,</span> <span class="s2">&quot;drl&quot;</span><span class="p">,</span> <span class="s2">&quot;eq_tree&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
<span class="n">_FontWeight</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">,</span> <span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="s2">&quot;semibold&quot;</span><span class="p">,</span> <span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="s2">&quot;heavy&quot;</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">]</span>
<span class="n">_FontSize</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;xx-small&quot;</span><span class="p">,</span> <span class="s2">&quot;x-small&quot;</span><span class="p">,</span> <span class="s2">&quot;small&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="s2">&quot;large&quot;</span><span class="p">,</span> <span class="s2">&quot;x-large&quot;</span><span class="p">,</span> <span class="s2">&quot;xx-large&quot;</span><span class="p">]</span>
<span class="n">VBound</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span> <span class="nb">float</span><span class="p">]]</span>


<div class="viewcode-block" id="scatter"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.scatter.html#ehrapy.plot.scatter">[docs]</a><span class="nd">@_doc_params</span><span class="p">(</span><span class="n">scatter_temp</span><span class="o">=</span><span class="n">doc_scatter_basic</span><span class="p">,</span> <span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">scatter</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layers</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sort_order</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">basis</span><span class="p">:</span> <span class="n">_Basis</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">groups</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">components</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">projection</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;2d&quot;</span><span class="p">,</span> <span class="s2">&quot;3d&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;2d&quot;</span><span class="p">,</span>
    <span class="n">legend_loc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;right margin&quot;</span><span class="p">,</span>
    <span class="n">legend_fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">_FontSize</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_fontweight</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">_FontWeight</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_fontoutline</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">color_map</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Colormap</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">palette</span><span class="p">:</span> <span class="n">Cycler</span> <span class="o">|</span> <span class="n">ListedColormap</span> <span class="o">|</span> <span class="n">ColorLike</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">ColorLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">frameon</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">right_margin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">left_margin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Scatter plot along observations or variables axes.</span>

<span class="sd">    Color the plot using annotations of observations (`.obs`), variables (`.var`) or features (`.var_names`).</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: :class:`~anndata.AnnData` object object containing all observations.</span>
<span class="sd">        x: x coordinate (MedCat entities currently not supported)</span>
<span class="sd">        y: y coordinate (MedCat entities currently not supported)</span>
<span class="sd">        color: Keys for annotations of observations/patients or features, or a hex color specification, e.g.,</span>
<span class="sd">               `&#39;ann1&#39;`, `&#39;#fe57a1&#39;`, or `[&#39;ann1&#39;, &#39;ann2&#39;]` or extracted entities from ehrapy&#39;s MedCat tool.</span>
<span class="sd">        use_raw: Whether to use `raw` attribute of `adata`. Defaults to `True` if `.raw` is present.</span>
<span class="sd">        layers: Use the `layers` attribute of `adata` if present: specify the layer for `x`, `y` and `color`.</span>
<span class="sd">                If `layers` is a string, then it is expanded to `(layers, layers, layers)`.</span>
<span class="sd">        basis: String that denotes a plotting tool that computed coordinates.</span>
<span class="sd">        {scatter_temp}</span>
<span class="sd">        {show_save_ax}</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `show==False` a :class:`~matplotlib.axes.Axes` or a list of it.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.pl.scatter(adata, x=&#39;age&#39;, y=&#39;icu_los_day&#39;, color=&#39;icu_los_day&#39;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/scatter.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scatter_partial</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">scatter</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="n">use_raw</span><span class="o">=</span><span class="n">use_raw</span><span class="p">,</span>
        <span class="n">layers</span><span class="o">=</span><span class="n">layers</span><span class="p">,</span>
        <span class="n">sort_order</span><span class="o">=</span><span class="n">sort_order</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
        <span class="n">basis</span><span class="o">=</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span>
        <span class="n">components</span><span class="o">=</span><span class="n">components</span><span class="p">,</span>
        <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span>
        <span class="n">legend_loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">,</span>
        <span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">,</span>
        <span class="n">legend_fontweight</span><span class="o">=</span><span class="n">legend_fontweight</span><span class="p">,</span>
        <span class="n">legend_fontoutline</span><span class="o">=</span><span class="n">legend_fontoutline</span><span class="p">,</span>
        <span class="n">color_map</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span>
        <span class="n">palette</span><span class="o">=</span><span class="n">palette</span><span class="p">,</span>
        <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span>
        <span class="n">right_margin</span><span class="o">=</span><span class="n">right_margin</span><span class="p">,</span>
        <span class="n">left_margin</span><span class="o">=</span><span class="n">left_margin</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">MedCAT</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">color</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="n">color</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="n">additional_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">colored_column</span> <span class="ow">in</span> <span class="n">color</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="ow">not</span> <span class="n">colored_column</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
                <span class="p">):</span>  <span class="c1"># hex codes are not treated as extracted entities</span>
                    <span class="n">EhrapyMedcat</span><span class="o">.</span><span class="n">add_binary_column_to_obs</span><span class="p">(</span>
                        <span class="n">adata</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">colored_column</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">additional_columns</span>  <span class="c1"># type: ignore</span>
                    <span class="p">)</span>

            <span class="n">scatter</span> <span class="o">=</span> <span class="n">scatter_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">additional_columns</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">scatter</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">scatter_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">scatter_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span></div>


<div class="viewcode-block" id="heatmap"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.heatmap.html#ehrapy.plot.heatmap">[docs]</a><span class="nd">@_doc_params</span><span class="p">(</span>
    <span class="n">vminmax</span><span class="o">=</span><span class="n">doc_vboundnorm</span><span class="p">,</span>
    <span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">,</span>
    <span class="n">common_plot_args</span><span class="o">=</span><span class="n">doc_common_plot_args</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">heatmap</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">var_names</span><span class="p">:</span> <span class="n">_VarNames</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_VarNames</span><span class="p">],</span>
    <span class="n">groupby</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">use_raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">num_categories</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
    <span class="n">dendrogram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">feature_symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_group_positions</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_group_labels</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_group_rotation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">standard_scale</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;obs&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">swap_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">show_feature_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vmin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vmax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vcenter</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">norm</span><span class="p">:</span> <span class="n">Normalize</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Heatmap of the feature values.</span>

<span class="sd">    If `groupby` is given, the heatmap is ordered by the respective group.</span>
<span class="sd">    If the `groupby` observation annotation is not categorical the observation</span>
<span class="sd">    annotation is turned into a categorical by binning the data into the number specified in `num_categories`.</span>

<span class="sd">    Args:</span>
<span class="sd">        {common_plot_args}</span>
<span class="sd">        standard_scale: Whether or not to standardize that dimension between 0 and 1, meaning for each variable or observation,</span>
<span class="sd">                        subtract the minimum and divide each by its maximum.</span>
<span class="sd">        swap_axes: By default, the x axis contains `var_names` (e.g. features) and the y axis the `groupby`</span>
<span class="sd">                   categories (if any). By setting `swap_axes` then x are the `groupby` categories and y the `var_names`.</span>
<span class="sd">        show_feature_labels: By default feature labels are shown when there are 50 or less features. Otherwise the labels are removed.</span>
<span class="sd">        {show_save_ax}</span>
<span class="sd">        {vminmax}</span>
<span class="sd">        **kwds:</span>
<span class="sd">            Are passed to :func:`matplotlib.pyplot.imshow`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of :class:`~matplotlib.axes.Axes`</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.5, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.heatmap(adata, var_names=[&#39;map_1st&#39;, &#39;hr_1st&#39;, &#39;temp_1st&#39;, &#39;spo2_1st&#39;,</span>
<span class="sd">                &#39;abg_count&#39;, &#39;wbc_first&#39;, &#39;hgb_first&#39;, &#39;platelet_first&#39;, &#39;sodium_first&#39;,</span>
<span class="sd">                &#39;potassium_first&#39;, &#39;tco2_first&#39;, &#39;chloride_first&#39;, &#39;bun_first&#39;,</span>
<span class="sd">                &#39;creatinine_first&#39;, &#39;po2_first&#39;, &#39;pco2_first&#39;, &#39;iv_day_1&#39;], groupby=&quot;leiden_0_5&quot;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/heatmap.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">heatmap_partial</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">heatmap</span><span class="p">,</span>
        <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
        <span class="n">use_raw</span><span class="o">=</span><span class="n">use_raw</span><span class="p">,</span>
        <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span>
        <span class="n">num_categories</span><span class="o">=</span><span class="n">num_categories</span><span class="p">,</span>
        <span class="n">dendrogram</span><span class="o">=</span><span class="n">dendrogram</span><span class="p">,</span>
        <span class="n">gene_symbols</span><span class="o">=</span><span class="n">feature_symbols</span><span class="p">,</span>
        <span class="n">var_group_positions</span><span class="o">=</span><span class="n">var_group_positions</span><span class="p">,</span>
        <span class="n">var_group_labels</span><span class="o">=</span><span class="n">var_group_labels</span><span class="p">,</span>
        <span class="n">var_group_rotation</span><span class="o">=</span><span class="n">var_group_rotation</span><span class="p">,</span>
        <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
        <span class="n">standard_scale</span><span class="o">=</span><span class="n">standard_scale</span><span class="p">,</span>
        <span class="n">swap_axes</span><span class="o">=</span><span class="n">swap_axes</span><span class="p">,</span>
        <span class="n">show_gene_labels</span><span class="o">=</span><span class="n">show_feature_labels</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
        <span class="n">vcenter</span><span class="o">=</span><span class="n">vcenter</span><span class="p">,</span>
        <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">MedCAT</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">groupby</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">groupby</span> <span class="o">=</span> <span class="p">[</span><span class="n">groupby</span><span class="p">]</span>
        <span class="n">additional_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">grp_column</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">grp_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span> <span class="ow">and</span> <span class="n">grp_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
                <span class="n">EhrapyMedcat</span><span class="o">.</span><span class="n">add_binary_column_to_obs</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">grp_column</span><span class="p">,</span> <span class="n">groupby</span><span class="p">,</span> <span class="n">additional_columns</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="n">heatmap</span> <span class="o">=</span> <span class="n">heatmap_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">)</span>
        <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">additional_columns</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">heatmap</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">heatmap_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">)</span></div>


<div class="viewcode-block" id="dotplot"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.dotplot.html#ehrapy.plot.dotplot">[docs]</a><span class="nd">@_doc_params</span><span class="p">(</span>
    <span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">,</span>
    <span class="n">common_plot_args</span><span class="o">=</span><span class="n">doc_common_plot_args</span><span class="p">,</span>
    <span class="n">groupby_plots_args</span><span class="o">=</span><span class="n">doc_common_groupby_plot_args</span><span class="p">,</span>
    <span class="n">vminmax</span><span class="o">=</span><span class="n">doc_vboundnorm</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">dotplot</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">var_names</span><span class="p">:</span> <span class="n">_VarNames</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_VarNames</span><span class="p">],</span>
    <span class="n">groupby</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">use_raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">num_categories</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
    <span class="n">feature_cutoff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">mean_only_counts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">cmap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Reds&quot;</span><span class="p">,</span>
    <span class="n">dot_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">DotPlot</span><span class="o">.</span><span class="n">DEFAULT_DOT_MAX</span><span class="p">,</span>
    <span class="n">dot_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">DotPlot</span><span class="o">.</span><span class="n">DEFAULT_DOT_MIN</span><span class="p">,</span>
    <span class="n">standard_scale</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">smallest_dot</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">DotPlot</span><span class="o">.</span><span class="n">DEFAULT_SMALLEST_DOT</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;Mean value in group&quot;</span><span class="p">,</span>
    <span class="n">size_title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">DotPlot</span><span class="o">.</span><span class="n">DEFAULT_SIZE_LEGEND_TITLE</span><span class="p">,</span>
    <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dendrogram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">feature_symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_group_positions</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_group_labels</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_group_rotation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">swap_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">dot_color_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">_AxesSubplot</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">vmin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vmax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vcenter</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">norm</span><span class="p">:</span> <span class="n">Normalize</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DotPlot</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Makes a *dot plot* of the count values of `var_names`.</span>

<span class="sd">    For each var_name and each `groupby` category a dot is plotted.</span>
<span class="sd">    Each dot represents two values: mean expression within each category</span>
<span class="sd">    (visualized by color) and fraction of observations expressing the `var_name` in the</span>
<span class="sd">    category (visualized by the size of the dot). If `groupby` is not given,</span>
<span class="sd">    the dotplot assumes that all data belongs to a single category.</span>

<span class="sd">    .. note::</span>
<span class="sd">       A count is used if it is above the specified threshold which is zero by default.</span>

<span class="sd">    Args:</span>
<span class="sd">        {common_plot_args}</span>
<span class="sd">        {groupby_plots_args}</span>
<span class="sd">        size_title: Title for the size legend. New line character (\\n) can be used.</span>
<span class="sd">        feature_cutoff: Count cutoff that is used for binarizing the counts and</span>
<span class="sd">                        determining the fraction of patients having the feature.</span>
<span class="sd">                        A feature is only used if its counts are greater than this threshold.</span>
<span class="sd">        mean_only_counts: If True, counts are averaged only over the patients having the provided feature.</span>
<span class="sd">        dot_max: If none, the maximum dot size is set to the maximum fraction value found</span>
<span class="sd">                 (e.g. 0.6). If given, the value should be a number between 0 and 1.</span>
<span class="sd">                 All fractions larger than dot_max are clipped to this value.</span>
<span class="sd">        dot_min: If none, the minimum dot size is set to 0. If given,</span>
<span class="sd">                 the value should be a number between 0 and 1.</span>
<span class="sd">                 All fractions smaller than dot_min are clipped to this value.</span>
<span class="sd">        smallest_dot: If none, the smallest dot has size 0. All counts with `dot_min` are plotted with this size.</span>
<span class="sd">        {show_save_ax}</span>
<span class="sd">        {vminmax}</span>
<span class="sd">        kwds:</span>
<span class="sd">            Are passed to :func:`matplotlib.pyplot.scatter`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `return_fig` is `True`, returns a :class:`~scanpy.pl.DotPlot` object, else if `show` is false, return axes dict</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.5, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.dotplot(adata,</span>
<span class="sd">                          var_names=[&#39;age&#39;, &#39;gender_num&#39;, &#39;weight_first&#39;, &#39;bmi&#39;,</span>
<span class="sd">                          &#39;wbc_first&#39;, &#39;hgb_first&#39;, &#39;platelet_first&#39;, &#39;sodium_first&#39;,</span>
<span class="sd">                          &#39;potassium_first&#39;, &#39;tco2_first&#39;, &#39;chloride_first&#39;, &#39;bun_first&#39;,</span>
<span class="sd">                          &#39;creatinine_first&#39;, &#39;po2_first&#39;, &#39;pco2_first&#39;],</span>
<span class="sd">                           groupby=&quot;leiden_0_5&quot;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/dotplot.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dotplot_partial</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">dotplot</span><span class="p">,</span>
        <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
        <span class="n">use_raw</span><span class="o">=</span><span class="n">use_raw</span><span class="p">,</span>
        <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span>
        <span class="n">num_categories</span><span class="o">=</span><span class="n">num_categories</span><span class="p">,</span>
        <span class="n">expression_cutoff</span><span class="o">=</span><span class="n">feature_cutoff</span><span class="p">,</span>
        <span class="n">mean_only_expressed</span><span class="o">=</span><span class="n">mean_only_counts</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">dot_max</span><span class="o">=</span><span class="n">dot_max</span><span class="p">,</span>
        <span class="n">dot_min</span><span class="o">=</span><span class="n">dot_min</span><span class="p">,</span>
        <span class="n">standard_scale</span><span class="o">=</span><span class="n">standard_scale</span><span class="p">,</span>
        <span class="n">smallest_dot</span><span class="o">=</span><span class="n">smallest_dot</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">colorbar_title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span>
        <span class="n">size_title</span><span class="o">=</span><span class="n">size_title</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
        <span class="n">dendrogram</span><span class="o">=</span><span class="n">dendrogram</span><span class="p">,</span>
        <span class="n">gene_symbols</span><span class="o">=</span><span class="n">feature_symbols</span><span class="p">,</span>
        <span class="n">var_group_positions</span><span class="o">=</span><span class="n">var_group_positions</span><span class="p">,</span>
        <span class="n">var_group_labels</span><span class="o">=</span><span class="n">var_group_labels</span><span class="p">,</span>
        <span class="n">var_group_rotation</span><span class="o">=</span><span class="n">var_group_rotation</span><span class="p">,</span>
        <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
        <span class="n">swap_axes</span><span class="o">=</span><span class="n">swap_axes</span><span class="p">,</span>
        <span class="n">dot_color_df</span><span class="o">=</span><span class="n">dot_color_df</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">return_fig</span><span class="o">=</span><span class="n">return_fig</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
        <span class="n">vcenter</span><span class="o">=</span><span class="n">vcenter</span><span class="p">,</span>
        <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">MedCAT</span><span class="p">):</span>
        <span class="c1"># keep loop and lists in case dotplot will accept sequences</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">groupby</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">groupby</span> <span class="o">=</span> <span class="p">[</span><span class="n">groupby</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
        <span class="n">additional_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">grp_column</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">grp_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span> <span class="ow">and</span> <span class="n">grp_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
                <span class="n">EhrapyMedcat</span><span class="o">.</span><span class="n">add_binary_column_to_obs</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">grp_column</span><span class="p">,</span> <span class="n">groupby</span><span class="p">,</span> <span class="n">additional_columns</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="n">dotplot</span> <span class="o">=</span> <span class="n">dotplot_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">additional_columns</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dotplot</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dotplot_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">)</span></div>


<div class="viewcode-block" id="tracksplot"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.tracksplot.html#ehrapy.plot.tracksplot">[docs]</a><span class="nd">@_doc_params</span><span class="p">(</span><span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">,</span> <span class="n">common_plot_args</span><span class="o">=</span><span class="n">doc_common_plot_args</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">tracksplot</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">var_names</span><span class="p">:</span> <span class="n">_VarNames</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_VarNames</span><span class="p">],</span>
    <span class="n">groupby</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">use_raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">dendrogram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">feature_symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_group_positions</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_group_labels</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Plots a filled line plot.</span>

<span class="sd">    In this type of plot each var_name is plotted as a filled line plot where the</span>
<span class="sd">    y values correspond to the var_name values and x is each of the observations. Best results</span>
<span class="sd">    are obtained when using raw counts that are not log.</span>
<span class="sd">    `groupby` is required to sort and order the values using the respective group and should be a categorical value.</span>

<span class="sd">    Args:</span>
<span class="sd">        {common_plot_args}</span>
<span class="sd">        {show_save_ax}</span>
<span class="sd">        **kwds:</span>
<span class="sd">            Are passed to :func:`~seaborn.heatmap`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of :class:`~matplotlib.axes.Axes`.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.5, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.tracksplot(adata, var_names=[&#39;age&#39;, &#39;gender_num&#39;, &#39;weight_first&#39;, &#39;bmi&#39;,</span>
<span class="sd">                &#39;sapsi_first&#39;, &#39;sofa_first&#39;, &#39;service_num&#39;, &#39;day_icu_intime_num&#39;,</span>
<span class="sd">                &#39;hour_icu_intime&#39;], groupby=&quot;leiden_0_5&quot;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/tracksplot.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tracksplot_partial</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">tracksplot</span><span class="p">,</span>
        <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
        <span class="n">use_raw</span><span class="o">=</span><span class="n">use_raw</span><span class="p">,</span>
        <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span>
        <span class="n">dendrogram</span><span class="o">=</span><span class="n">dendrogram</span><span class="p">,</span>
        <span class="n">gene_symbols</span><span class="o">=</span><span class="n">feature_symbols</span><span class="p">,</span>
        <span class="n">var_group_positions</span><span class="o">=</span><span class="n">var_group_positions</span><span class="p">,</span>
        <span class="n">var_group_labels</span><span class="o">=</span><span class="n">var_group_labels</span><span class="p">,</span>
        <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">MedCAT</span><span class="p">):</span>
        <span class="c1"># keep the list and loop in case of groupby could be a sequence in future</span>
        <span class="n">groupby</span> <span class="o">=</span> <span class="p">[</span><span class="n">groupby</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
        <span class="n">additional_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">grp_col</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">grp_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span> <span class="ow">and</span> <span class="n">grp_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
                <span class="n">EhrapyMedcat</span><span class="o">.</span><span class="n">add_binary_column_to_obs</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">grp_col</span><span class="p">,</span> <span class="n">groupby</span><span class="p">,</span> <span class="n">additional_columns</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="n">tracksplot</span> <span class="o">=</span> <span class="n">tracksplot_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">additional_columns</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tracksplot</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tracksplot_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">)</span></div>


<div class="viewcode-block" id="violin"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.violin.html#ehrapy.plot.violin">[docs]</a><span class="k">def</span> <span class="nf">violin</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">keys</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">groupby</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">use_raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">stripplot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">jitter</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">layer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">scale</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;width&quot;</span><span class="p">,</span>
    <span class="n">order</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">multi_panel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">rotation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Violin plot.</span>

<span class="sd">    Wraps :func:`seaborn.violinplot` for :class:`~anndata.AnnData`.</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: :class:`~anndata.AnnData` object object containing all observations.</span>
<span class="sd">        keys: Keys for accessing variables of `.var_names` or fields of `.obs`.</span>
<span class="sd">        groupby: The key of the observation grouping to consider. Could also be an entity extracted by ehrapy&#39;s medcat tool.</span>
<span class="sd">        log: Plot on logarithmic axis.</span>
<span class="sd">        use_raw: Whether to use `raw` attribute of `adata`. Defaults to `True` if `.raw` is present.</span>
<span class="sd">        stripplot: Add a stripplot on top of the violin plot. See :func:`~seaborn.stripplot`.</span>
<span class="sd">        jitter: Add jitter to the stripplot (only when stripplot is True) See :func:`~seaborn.stripplot`.</span>
<span class="sd">        size: Size of the jitter points.</span>
<span class="sd">        layer: Name of the AnnData object layer that wants to be plotted. By</span>
<span class="sd">               default adata.raw.X is plotted. If `use_raw=False` is set,</span>
<span class="sd">               then `adata.X` is plotted. If `layer` is set to a valid layer name,</span>
<span class="sd">               then the layer is plotted. `layer` takes precedence over `use_raw`.</span>
<span class="sd">        scale: The method used to scale the width of each violin.</span>
<span class="sd">               If &#39;width&#39; (the default), each violin will have the same width.</span>
<span class="sd">               If &#39;area&#39;, each violin will have the same area.</span>
<span class="sd">               If &#39;count&#39;, a violins width corresponds to the number of observations.</span>
<span class="sd">        order: Order in which to show the categories.</span>
<span class="sd">        multi_panel: Display keys in multiple panels also when `groupby is not None`.</span>
<span class="sd">        xlabel: Label of the x axis. Defaults to `groupby` if `rotation` is `None`, otherwise, no label is shown.</span>
<span class="sd">        ylabel: Label of the y axis. If `None` and `groupby` is `None`, defaults to `&#39;value&#39;`.</span>
<span class="sd">                If `None` and `groubpy` is not `None`, defaults to `keys`.</span>
<span class="sd">        rotation: Rotation of xtick labels.</span>
<span class="sd">        {show_save_ax}</span>
<span class="sd">        **kwds:</span>
<span class="sd">            Are passed to :func:`~seaborn.violinplot`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A :class:`~matplotlib.axes.Axes` object if `ax` is `None` else `None`.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.5, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.violin(adata, keys=[&#39;age&#39;], groupby=&quot;leiden_0_5&quot;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/violin.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">violin_partial</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">violin</span><span class="p">,</span>
        <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span>
        <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span>
        <span class="n">use_raw</span><span class="o">=</span><span class="n">use_raw</span><span class="p">,</span>
        <span class="n">stripplot</span><span class="o">=</span><span class="n">stripplot</span><span class="p">,</span>
        <span class="n">jitter</span><span class="o">=</span><span class="n">jitter</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
        <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
        <span class="n">multi_panel</span><span class="o">=</span><span class="n">multi_panel</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
        <span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">MedCAT</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">groupby</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">groupby</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">groupby</span> <span class="o">=</span> <span class="p">[</span><span class="n">groupby</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="n">additional_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">grp_column</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">grp_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span> <span class="ow">and</span> <span class="n">grp_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
                    <span class="n">EhrapyMedcat</span><span class="o">.</span><span class="n">add_binary_column_to_obs</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">grp_column</span><span class="p">,</span> <span class="n">groupby</span><span class="p">,</span> <span class="n">additional_columns</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="n">violin</span> <span class="o">=</span> <span class="n">violin_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">additional_columns</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">violin</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">violin_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">violin_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">)</span></div>


<div class="viewcode-block" id="stacked_violin"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.stacked_violin.html#ehrapy.plot.stacked_violin">[docs]</a><span class="nd">@_doc_params</span><span class="p">(</span>
    <span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">,</span>
    <span class="n">common_plot_args</span><span class="o">=</span><span class="n">doc_common_plot_args</span><span class="p">,</span>
    <span class="n">groupby_plots_args</span><span class="o">=</span><span class="n">doc_common_groupby_plot_args</span><span class="p">,</span>
    <span class="n">vminmax</span><span class="o">=</span><span class="n">doc_vboundnorm</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">stacked_violin</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">var_names</span><span class="p">:</span> <span class="n">_VarNames</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_VarNames</span><span class="p">],</span>
    <span class="n">groupby</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">use_raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_categories</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;Median value</span><span class="se">\n</span><span class="s2"> in group&quot;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dendrogram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">gene_symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_group_positions</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_group_labels</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">standard_scale</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;obs&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_group_rotation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">stripplot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">StackedViolin</span><span class="o">.</span><span class="n">DEFAULT_STRIPPLOT</span><span class="p">,</span>
    <span class="n">jitter</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">StackedViolin</span><span class="o">.</span><span class="n">DEFAULT_JITTER</span><span class="p">,</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">StackedViolin</span><span class="o">.</span><span class="n">DEFAULT_JITTER_SIZE</span><span class="p">,</span>
    <span class="n">scale</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">StackedViolin</span><span class="o">.</span><span class="n">DEFAULT_SCALE</span><span class="p">,</span>
    <span class="n">yticklabels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">StackedViolin</span><span class="o">.</span><span class="n">DEFAULT_PLOT_YTICKLABELS</span><span class="p">,</span>
    <span class="n">order</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">swap_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">row_palette</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">StackedViolin</span><span class="o">.</span><span class="n">DEFAULT_ROW_PALETTE</span><span class="p">,</span>
    <span class="n">cmap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">StackedViolin</span><span class="o">.</span><span class="n">DEFAULT_COLORMAP</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">_AxesSubplot</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vmin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vmax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vcenter</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">norm</span><span class="p">:</span> <span class="n">Normalize</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StackedViolin</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Stacked violin plots.</span>

<span class="sd">    Makes a compact image composed of individual violin plots (from :func:`~seaborn.violinplot`) stacked on top of each other.</span>

<span class="sd">    This function provides a convenient interface to the :class:`~scanpy.pl.StackedViolin` class.</span>
<span class="sd">    If you need more flexibility, you should use :class:`~scanpy.pl.StackedViolin` directly.</span>


<span class="sd">    Args:</span>
<span class="sd">        {common_plot_args}</span>
<span class="sd">        {groupby_plots_args}</span>
<span class="sd">        stripplot: Add a stripplot on top of the violin plot. See :func:`~seaborn.stripplot`.</span>
<span class="sd">        jitter: Add jitter to the stripplot (only when stripplot is True) See :func:`~seaborn.stripplot`.</span>
<span class="sd">        size: Size of the jitter points.</span>
<span class="sd">        yticklabels: Set to true to view the y tick labels</span>
<span class="sd">        order: Order in which to show the categories. Note: if `dendrogram=True`</span>
<span class="sd">               the categories order will be given by the dendrogram and `order` will be ignored.</span>
<span class="sd">        scale: The method used to scale the width of each violin.</span>
<span class="sd">               If &#39;width&#39; (the default), each violin will have the same width.</span>
<span class="sd">               If &#39;area&#39;, each violin will have the same area.</span>
<span class="sd">               If &#39;count&#39;, a violins width corresponds to the number of observations.</span>
<span class="sd">        row_palette: Be default, median values are mapped to the violin color using a</span>
<span class="sd">                     color map (see `cmap` argument). Alternatively, a &#39;row_palette` can</span>
<span class="sd">                     be given to color each violin plot row using a different colors.</span>
<span class="sd">                     The value should be a valid seaborn or matplotlib palette name (see :func:`~seaborn.color_palette`).</span>
<span class="sd">                     Alternatively, a single color name or hex value can be passed, e.g. `&#39;red&#39;` or `&#39;#cc33ff&#39;`.</span>
<span class="sd">        {show_save_ax}</span>
<span class="sd">        {vminmax}</span>
<span class="sd">        kwds:</span>
<span class="sd">            Are passed to :func:`~seaborn.violinplot`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `return_fig` is `True`, returns a :class:`~scanpy.pl.StackedViolin` object, else if `show` is false, return axes dict</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.5, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.stacked_violin(adata, var_names=[&#39;icu_los_day&#39;,</span>
<span class="sd">                &#39;hospital_los_day&#39;, &#39;age&#39;, &#39;gender_num&#39;, &#39;weight_first&#39;, &#39;bmi&#39;,</span>
<span class="sd">                &#39;sapsi_first&#39;, &#39;sofa_first&#39;, &#39;service_num&#39;, &#39;day_icu_intime_num&#39;,</span>
<span class="sd">                &#39;hour_icu_intime&#39;], groupby=&quot;leiden_0_5&quot;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/stacked_violin.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stacked_vio_partial</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">stacked_violin</span><span class="p">,</span>
        <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
        <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span>
        <span class="n">use_raw</span><span class="o">=</span><span class="n">use_raw</span><span class="p">,</span>
        <span class="n">num_categories</span><span class="o">=</span><span class="n">num_categories</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">colorbar_title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
        <span class="n">dendrogram</span><span class="o">=</span><span class="n">dendrogram</span><span class="p">,</span>
        <span class="n">gene_symbols</span><span class="o">=</span><span class="n">gene_symbols</span><span class="p">,</span>
        <span class="n">var_group_positions</span><span class="o">=</span><span class="n">var_group_positions</span><span class="p">,</span>
        <span class="n">var_group_labels</span><span class="o">=</span><span class="n">var_group_labels</span><span class="p">,</span>
        <span class="n">standard_scale</span><span class="o">=</span><span class="n">standard_scale</span><span class="p">,</span>
        <span class="n">var_group_rotation</span><span class="o">=</span><span class="n">var_group_rotation</span><span class="p">,</span>
        <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
        <span class="n">stripplot</span><span class="o">=</span><span class="n">stripplot</span><span class="p">,</span>
        <span class="n">jitter</span><span class="o">=</span><span class="n">jitter</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
        <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,</span>
        <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
        <span class="n">swap_axes</span><span class="o">=</span><span class="n">swap_axes</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="n">return_fig</span><span class="o">=</span><span class="n">return_fig</span><span class="p">,</span>
        <span class="n">row_palette</span><span class="o">=</span><span class="n">row_palette</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
        <span class="n">vcenter</span><span class="o">=</span><span class="n">vcenter</span><span class="p">,</span>
        <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">MedCAT</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">groupby</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">groupby</span> <span class="o">=</span> <span class="p">[</span><span class="n">groupby</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
        <span class="n">additional_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">colored_column</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span> <span class="ow">and</span> <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span>
                <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">columns</span>
            <span class="p">):</span>
                <span class="n">EhrapyMedcat</span><span class="o">.</span><span class="n">add_binary_column_to_obs</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">colored_column</span><span class="p">,</span> <span class="n">groupby</span><span class="p">,</span> <span class="n">additional_columns</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="n">stacked_violin</span> <span class="o">=</span> <span class="n">stacked_vio_partial</span><span class="p">(</span>
            <span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">groupby</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="k">else</span> <span class="n">groupby</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">additional_columns</span><span class="p">:</span>
            <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">additional_columns</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stacked_violin</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">stacked_vio_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">)</span></div>


<div class="viewcode-block" id="matrixplot"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.matrixplot.html#ehrapy.plot.matrixplot">[docs]</a><span class="nd">@_doc_params</span><span class="p">(</span>
    <span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">,</span>
    <span class="n">common_plot_args</span><span class="o">=</span><span class="n">doc_common_plot_args</span><span class="p">,</span>
    <span class="n">groupby_plots_args</span><span class="o">=</span><span class="n">doc_common_groupby_plot_args</span><span class="p">,</span>
    <span class="n">vminmax</span><span class="o">=</span><span class="n">doc_vboundnorm</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">matrixplot</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">var_names</span><span class="p">:</span> <span class="n">_VarNames</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_VarNames</span><span class="p">],</span>
    <span class="n">groupby</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">use_raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">num_categories</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
    <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dendrogram</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cmap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">MatrixPlot</span><span class="o">.</span><span class="n">DEFAULT_COLORMAP</span><span class="p">,</span>
    <span class="n">colorbar_title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;Mean value</span><span class="se">\n</span><span class="s2"> in group&quot;</span><span class="p">,</span>
    <span class="n">gene_symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_group_positions</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_group_labels</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_group_rotation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">standard_scale</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">values_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">swap_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">_AxesSubplot</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">vmin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vmax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vcenter</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">norm</span><span class="p">:</span> <span class="n">Normalize</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MatrixPlot</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Creates a heatmap of the mean count per group of each var_names.</span>

<span class="sd">    This function provides a convenient interface to the :class:`~scanpy.pl.MatrixPlot`</span>
<span class="sd">    class. If you need more flexibility, you should use :class:`~scanpy.pl.MatrixPlot` directly.</span>


<span class="sd">    Args:</span>
<span class="sd">        {common_plot_args}</span>
<span class="sd">        {groupby_plots_args}</span>
<span class="sd">        {show_save_ax}</span>
<span class="sd">        {vminmax}</span>
<span class="sd">        kwds:</span>
<span class="sd">            Are passed to :func:`matplotlib.pyplot.pcolor`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `return_fig` is `True`, returns a :class:`~scanpy.pl.MatrixPlot` object, else if `show` is false, return axes dict</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.5, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.matrixplot(adata, var_names=[</span>
<span class="sd">                &#39;abg_count&#39;, &#39;wbc_first&#39;, &#39;hgb_first&#39;, &#39;platelet_first&#39;, &#39;sodium_first&#39;,</span>
<span class="sd">                &#39;potassium_first&#39;, &#39;tco2_first&#39;, &#39;chloride_first&#39;, &#39;bun_first&#39;,</span>
<span class="sd">                &#39;creatinine_first&#39;, &#39;po2_first&#39;, &#39;pco2_first&#39;, &#39;iv_day_1&#39;], groupby=&quot;leiden_0_5&quot;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/matrixplot.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matrix_partial</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">matrixplot</span><span class="p">,</span>
        <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
        <span class="n">use_raw</span><span class="o">=</span><span class="n">use_raw</span><span class="p">,</span>
        <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span>
        <span class="n">num_categories</span><span class="o">=</span><span class="n">num_categories</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
        <span class="n">dendrogram</span><span class="o">=</span><span class="n">dendrogram</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">colorbar_title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span>
        <span class="n">gene_symbols</span><span class="o">=</span><span class="n">gene_symbols</span><span class="p">,</span>
        <span class="n">var_group_positions</span><span class="o">=</span><span class="n">var_group_positions</span><span class="p">,</span>
        <span class="n">var_group_labels</span><span class="o">=</span><span class="n">var_group_labels</span><span class="p">,</span>
        <span class="n">var_group_rotation</span><span class="o">=</span><span class="n">var_group_rotation</span><span class="p">,</span>
        <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
        <span class="n">standard_scale</span><span class="o">=</span><span class="n">standard_scale</span><span class="p">,</span>
        <span class="n">values_df</span><span class="o">=</span><span class="n">values_df</span><span class="p">,</span>
        <span class="n">swap_axes</span><span class="o">=</span><span class="n">swap_axes</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">return_fig</span><span class="o">=</span><span class="n">return_fig</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
        <span class="n">vcenter</span><span class="o">=</span><span class="n">vcenter</span><span class="p">,</span>
        <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">MedCAT</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">groupby</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">groupby</span> <span class="o">=</span> <span class="p">[</span><span class="n">groupby</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
        <span class="n">additional_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">colored_column</span> <span class="ow">in</span> <span class="n">groupby</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span> <span class="ow">and</span> <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span>
                <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">columns</span>
            <span class="p">):</span>
                <span class="n">EhrapyMedcat</span><span class="o">.</span><span class="n">add_binary_column_to_obs</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">colored_column</span><span class="p">,</span> <span class="n">groupby</span><span class="p">,</span> <span class="n">additional_columns</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="n">matrixplot</span> <span class="o">=</span> <span class="n">matrix_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">additional_columns</span><span class="p">:</span>
            <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">additional_columns</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">matrixplot</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">matrix_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">)</span></div>


<div class="viewcode-block" id="clustermap"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.clustermap.html#ehrapy.plot.clustermap">[docs]</a><span class="nd">@_doc_params</span><span class="p">(</span><span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">clustermap</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">obs_keys</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Hierarchically-clustered heatmap.</span>

<span class="sd">    Wraps :func:`seaborn.clustermap` for :class:`~anndata.AnnData`.</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: :class:`~anndata.AnnData` object object containing all observations.</span>
<span class="sd">        obs_keys: Categorical annotation to plot with a different color map. Currently, only a single key is supported.</span>
<span class="sd">        use_raw: Whether to use `raw` attribute of `adata`. Defaults to `True` if `.raw` is present.</span>
<span class="sd">        {show_save_ax}</span>
<span class="sd">        **kwds:</span>
<span class="sd">            Keyword arguments passed to :func:`~seaborn.clustermap`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `show` is `False`, a :class:`~seaborn.ClusterGrid` object (see :func:`~seaborn.clustermap`).</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.5, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.clustermap(adata)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/clustermap.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">clustermap_partial</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">clustermap</span><span class="p">,</span> <span class="n">use_raw</span><span class="o">=</span><span class="n">use_raw</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">MedCAT</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obs_keys</span><span class="p">:</span>
            <span class="n">grp_flag</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">obs_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs_keys</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="k">if</span> <span class="n">obs_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obs_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
                <span class="n">EhrapyMedcat</span><span class="o">.</span><span class="n">add_binary_column_to_obs</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">obs_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">obs_keys</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
                <span class="n">grp_flag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">clustermap</span> <span class="o">=</span> <span class="n">clustermap_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">obs_keys</span><span class="o">=</span><span class="n">obs_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">grp_flag</span><span class="p">:</span>
                <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">obs_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">clustermap</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">clustermap_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">obs_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">clustermap_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="n">obs_keys</span><span class="o">=</span><span class="n">obs_keys</span><span class="p">)</span></div>


<div class="viewcode-block" id="ranking"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.ranking.html#ehrapy.plot.ranking">[docs]</a><span class="k">def</span> <span class="nf">ranking</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">attr</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;var&quot;</span><span class="p">,</span> <span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="s2">&quot;uns&quot;</span><span class="p">,</span> <span class="s2">&quot;varm&quot;</span><span class="p">,</span> <span class="s2">&quot;obsm&quot;</span><span class="p">],</span>
    <span class="n">keys</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">dictionary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
    <span class="n">n_points</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">include_lowest</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">show</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Plot rankings.</span>

<span class="sd">    See, for example, how this is used in pl.pca_ranking.</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: :class:`~anndata.AnnData` object object containing all observations.</span>
<span class="sd">        attr: The attribute of AnnData that contains the score.</span>
<span class="sd">        keys: The scores to look up an array from the attribute of adata.</span>
<span class="sd">        dictionary: Optional key dictionary.</span>
<span class="sd">        indices: Optional dictionary indices.</span>
<span class="sd">        labels: Optional labels.</span>
<span class="sd">        color: Optional primary color (default: black).</span>
<span class="sd">        n_points: Number of points (default: 30)..</span>
<span class="sd">        log: Whether logarithmic scale should be used.</span>
<span class="sd">        include_lowest: Whether to include the lowest points.</span>
<span class="sd">        show: Whether to show the plot.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Returns matplotlib gridspec with access to the axes.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">ranking</span><span class="p">(</span>
        <span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span>
        <span class="n">attr</span><span class="o">=</span><span class="n">attr</span><span class="p">,</span>
        <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span>
        <span class="n">dictionary</span><span class="o">=</span><span class="n">dictionary</span><span class="p">,</span>
        <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">n_points</span><span class="o">=</span><span class="n">n_points</span><span class="p">,</span>
        <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span>
        <span class="n">include_lowest</span><span class="o">=</span><span class="n">include_lowest</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="dendrogram"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.dendrogram.html#ehrapy.plot.dendrogram">[docs]</a><span class="nd">@_doc_params</span><span class="p">(</span><span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dendrogram</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">groupby</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">dendrogram_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">orientation</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">remove_labels</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Plots a dendrogram of the categories defined in `groupby`.</span>

<span class="sd">    See :func:`~ehrapy.tl.dendrogram`.</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: :class:`~anndata.AnnData` object object containing all observations.</span>
<span class="sd">        groupby: Categorical data column used to create the dendrogram.</span>
<span class="sd">        dendrogram_key: Key under with the dendrogram information was stored.</span>
<span class="sd">                        By default the dendrogram information is stored under `.uns[f&#39;dendrogram_{{groupby}}&#39;]`.</span>
<span class="sd">        orientation: Origin of the tree. Will grow into the opposite direction.</span>
<span class="sd">        remove_labels: Dont draw labels. Used e.g. by :func:`scanpy.pl.matrixplot` to annotate matrix columns/rows.</span>
<span class="sd">        {show_save_ax}</span>

<span class="sd">    Returns:</span>
<span class="sd">        :class:`matplotlib.axes.Axes`</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.5, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.dendrogram(adata, groupby=&quot;leiden_0_5&quot;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/dendrogram.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dendrogram_partial</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">dendrogram</span><span class="p">,</span>
        <span class="n">dendrogram_key</span><span class="o">=</span><span class="n">dendrogram_key</span><span class="p">,</span>
        <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span>
        <span class="n">remove_labels</span><span class="o">=</span><span class="n">remove_labels</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">MedCAT</span><span class="p">):</span>
        <span class="n">grp_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">groupby</span> <span class="o">=</span> <span class="p">[</span><span class="n">groupby</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
        <span class="k">if</span> <span class="n">groupby</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span> <span class="ow">and</span> <span class="n">groupby</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
            <span class="n">EhrapyMedcat</span><span class="o">.</span><span class="n">add_binary_column_to_obs</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">groupby</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">groupby</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
            <span class="n">grp_flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">dendrogram</span> <span class="o">=</span> <span class="n">dendrogram_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">grp_flag</span><span class="p">:</span>
            <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">groupby</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dendrogram</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dendrogram_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">)</span></div>


<div class="viewcode-block" id="pca"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.pca.html#ehrapy.plot.pca">[docs]</a><span class="nd">@_wraps_plot_scatter</span>
<span class="nd">@_doc_params</span><span class="p">(</span>
    <span class="n">adata_color_etc</span><span class="o">=</span><span class="n">doc_adata_color_etc</span><span class="p">,</span>
    <span class="n">scatter_bulk</span><span class="o">=</span><span class="n">doc_scatter_embedding</span><span class="p">,</span>
    <span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">pca</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">annotate_var_explained</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Axes</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Scatter plot in PCA coordinates.</span>

<span class="sd">    Use the parameter `annotate_var_explained` to annotate the explained variance.</span>

<span class="sd">    Args:</span>
<span class="sd">        {adata_color_etc}</span>
<span class="sd">        annotate_var_explained: Whether to only annotate the explained variables.</span>
<span class="sd">        {scatter_bulk}</span>
<span class="sd">        {show_save_ax}</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `show==False` a :class:`~matplotlib.axes.Axes` or a list of it.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.pca(adata)</span>
<span class="sd">            ep.pl.pca(adata, color=&quot;service_unit)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/pca.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pca_partial</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">pca</span><span class="p">,</span> <span class="n">annotate_var_explained</span><span class="o">=</span><span class="n">annotate_var_explained</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span> <span class="n">return_fig</span><span class="o">=</span><span class="n">return_fig</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">MedCAT</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]]</span>
            <span class="n">additional_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">colored_column</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span> <span class="ow">and</span> <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">columns</span>
                <span class="p">):</span>
                    <span class="n">EhrapyMedcat</span><span class="o">.</span><span class="n">add_binary_column_to_obs</span><span class="p">(</span>
                        <span class="n">adata</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">colored_column</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span> <span class="n">additional_columns</span>
                    <span class="p">)</span>
            <span class="n">pca</span> <span class="o">=</span> <span class="n">pca_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">additional_columns</span><span class="p">:</span>
                <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">additional_columns</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pca</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pca_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pca_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="pca_loadings"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.pca_loadings.html#ehrapy.plot.pca_loadings">[docs]</a><span class="k">def</span> <span class="nf">pca_loadings</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">components</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">include_lowest</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Rank features according to contributions to PCs.</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: :class:`~anndata.AnnData` object object containing all observations.</span>
<span class="sd">        components: For example, ``&#39;1,2,3&#39;`` means ``[1, 2, 3]``, first, second, third principal component.</span>
<span class="sd">        include_lowest: Whether to show the features with both highest and lowest loadings.</span>
<span class="sd">        show: Show the plot, do not return axis.</span>
<span class="sd">        save: If `True` or a `str`, save the figure. A string is appended to the default filename.</span>
<span class="sd">              Infer the filetype if ending on {`&#39;.pdf&#39;`, `&#39;.png&#39;`, `&#39;.svg&#39;`}.</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `show==False` a :class:`~matplotlib.axes.Axes` or a list of it.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.pp.pca(adata)</span>
<span class="sd">            ep.pl.pca_loadings(adata, components=&#39;1,2,3&#39;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/pca_loadings.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">pca_loadings</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="n">components</span><span class="p">,</span> <span class="n">include_lowest</span><span class="o">=</span><span class="n">include_lowest</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">)</span></div>


<div class="viewcode-block" id="pca_variance_ratio"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.pca_variance_ratio.html#ehrapy.plot.pca_variance_ratio">[docs]</a><span class="k">def</span> <span class="nf">pca_variance_ratio</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">n_pcs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">log</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Plot the variance ratio.</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: :class:`~anndata.AnnData` object object containing all observations.</span>
<span class="sd">        n_pcs: Number of PCs to show.</span>
<span class="sd">        log: Plot on logarithmic scale..</span>
<span class="sd">        show: Show the plot, do not return axis.</span>
<span class="sd">        save: If `True` or a `str`, save the figure.</span>
<span class="sd">              A string is appended to the default filename.</span>
<span class="sd">              Infer the filetype if ending on {`&#39;.pdf&#39;`, `&#39;.png&#39;`, `&#39;.svg&#39;`}.</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `show==False` a :class:`~matplotlib.axes.Axes` or a list of it.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.pp.pca(adata)</span>
<span class="sd">            ep.pl.pca_variance_ratio(adata, n_pcs=8)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/pca_variance_ratio.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">pca_variance_ratio</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="n">n_pcs</span><span class="o">=</span><span class="n">n_pcs</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">)</span></div>


<div class="viewcode-block" id="pca_overview"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.pca_overview.html#ehrapy.plot.pca_overview">[docs]</a><span class="nd">@_doc_params</span><span class="p">(</span><span class="n">scatter_bulk</span><span class="o">=</span><span class="n">doc_scatter_embedding</span><span class="p">,</span> <span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">pca_overview</span><span class="p">(</span><span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Plot PCA results.</span>

<span class="sd">    The parameters are the ones of the scatter plot. Call pca_ranking separately</span>
<span class="sd">    if you want to change the default settings.</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: :class:`~anndata.AnnData` object object containing all observations.</span>
<span class="sd">        {scatter_bulk}</span>
<span class="sd">        {show_save_ax}</span>
<span class="sd">        **params: Scatterplot parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `show==False` a :class:`~matplotlib.axes.Axes` or a list of it.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.pp.pca(adata)</span>
<span class="sd">            ep.pl.pca_overview(adata, components=&#39;1,2,3&#39;, color=&quot;service_unit&quot;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/pca_overview_1.png</span>

<span class="sd">        .. image:: /_static/docstring_previews/pca_overview_2.png</span>

<span class="sd">        .. image:: /_static/docstring_previews/pca_overview_3.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">pca_overview</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></div>


<div class="viewcode-block" id="tsne"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.tsne.html#ehrapy.plot.tsne">[docs]</a><span class="nd">@_wraps_plot_scatter</span>
<span class="nd">@_doc_params</span><span class="p">(</span>
    <span class="n">adata_color_etc</span><span class="o">=</span><span class="n">doc_adata_color_etc</span><span class="p">,</span>
    <span class="n">edges_arrows</span><span class="o">=</span><span class="n">doc_edges_arrows</span><span class="p">,</span>
    <span class="n">scatter_bulk</span><span class="o">=</span><span class="n">doc_scatter_embedding</span><span class="p">,</span>
    <span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">tsne</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Axes</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Scatter plot in tSNE basis.</span>

<span class="sd">    Args:</span>
<span class="sd">        {adata_color_etc}</span>
<span class="sd">        {edges_arrows}</span>
<span class="sd">        {scatter_bulk}</span>
<span class="sd">        {show_save_ax}</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `show==False` a :class:`~matplotlib.axes.Axes` or a list of it.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.tsne(adata)</span>
<span class="sd">            ep.pl.tsne(adata)</span>

<span class="sd">        .. image:: /_static/docstring_previews/tsne_1.png</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            ep.pl.tsne(adata, color=[&quot;day_icu_intime&quot;, &quot;service_unit&quot;], wspace=0.5, title=[&quot;Day of ICU admission&quot;, &quot;Service unit&quot;])</span>

<span class="sd">        .. image:: /_static/docstring_previews/tsne_2.png</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            ep.tl.leiden(adata, resolution=0.5, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.tsne(adata, color=[&quot;leiden_0_5&quot;], title=&quot;Leiden 0.5&quot;)</span>

<span class="sd">        .. image:: /_static/docstring_previews/tsne_3.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">MedCAT</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]]</span>
            <span class="n">additional_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">colored_column</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span> <span class="ow">and</span> <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">columns</span>
                <span class="p">):</span>
                    <span class="n">EhrapyMedcat</span><span class="o">.</span><span class="n">add_binary_column_to_obs</span><span class="p">(</span>
                        <span class="n">adata</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">colored_column</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span> <span class="n">additional_columns</span>
                    <span class="p">)</span>
            <span class="n">tsne</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">tsne</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">additional_columns</span><span class="p">:</span>
                <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">additional_columns</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">tsne</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">tsne</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">tsne</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="umap"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.umap.html#ehrapy.plot.umap">[docs]</a><span class="nd">@_wraps_plot_scatter</span>
<span class="nd">@_doc_params</span><span class="p">(</span>
    <span class="n">adata_color_etc</span><span class="o">=</span><span class="n">doc_adata_color_etc</span><span class="p">,</span>
    <span class="n">edges_arrows</span><span class="o">=</span><span class="n">doc_edges_arrows</span><span class="p">,</span>
    <span class="n">scatter_bulk</span><span class="o">=</span><span class="n">doc_scatter_embedding</span><span class="p">,</span>
    <span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">umap</span><span class="p">(</span><span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span> <span class="o">|</span> <span class="n">MedCAT</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Axes</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Scatter plot in UMAP basis.</span>

<span class="sd">    Args:</span>
<span class="sd">        {adata_color_etc}</span>
<span class="sd">        {edges_arrows}</span>
<span class="sd">        {scatter_bulk}</span>
<span class="sd">        {show_save_ax}</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `show==False` a :class:`~matplotlib.axes.Axes` or a list of it.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.umap(adata)</span>
<span class="sd">            ep.pl.umap(adata)</span>

<span class="sd">        .. image:: /_static/docstring_previews/umap_1.png</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            ep.pl.umap(adata, color=[&quot;day_icu_intime&quot;, &quot;service_unit&quot;], wspace=0.5, title=[&quot;Day of ICU admission&quot;, &quot;Service unit&quot;])</span>

<span class="sd">        .. image:: /_static/docstring_previews/umap_2.png</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            ep.tl.leiden(adata, resolution=0.5, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.umap(adata, color=[&quot;leiden_0_5&quot;], title=&quot;Leiden 0.5&quot;)</span>

<span class="sd">        .. image:: /_static/docstring_previews/umap_3.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">MedCAT</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]]</span>
            <span class="n">additional_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">colored_column</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span> <span class="ow">and</span> <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">columns</span>
                <span class="p">):</span>
                    <span class="n">EhrapyMedcat</span><span class="o">.</span><span class="n">add_binary_column_to_obs</span><span class="p">(</span>
                        <span class="n">adata</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">colored_column</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span> <span class="n">additional_columns</span>
                    <span class="p">)</span>
            <span class="n">umap</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">additional_columns</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">umap</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="diffmap"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.diffmap.html#ehrapy.plot.diffmap">[docs]</a><span class="nd">@_wraps_plot_scatter</span>
<span class="nd">@_doc_params</span><span class="p">(</span>
    <span class="n">adata_color_etc</span><span class="o">=</span><span class="n">doc_adata_color_etc</span><span class="p">,</span>
    <span class="n">scatter_bulk</span><span class="o">=</span><span class="n">doc_scatter_embedding</span><span class="p">,</span>
    <span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">diffmap</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Axes</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Scatter plot in Diffusion Map basis.</span>

<span class="sd">    Args:</span>
<span class="sd">        {adata_color_etc}</span>
<span class="sd">        {scatter_bulk}</span>
<span class="sd">        {show_save_ax}</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `show==False` a :class:`~matplotlib.axes.Axes` or a list of it.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.diffmap(adata)</span>
<span class="sd">            ep.pl.diffmap(adata, color=&#39;day_icu_intime&#39;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/diffmap.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">MedCAT</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]]</span>
            <span class="n">additional_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">colored_column</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span> <span class="ow">and</span> <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">columns</span>
                <span class="p">):</span>
                    <span class="n">EhrapyMedcat</span><span class="o">.</span><span class="n">add_binary_column_to_obs</span><span class="p">(</span>
                        <span class="n">adata</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">colored_column</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span> <span class="n">additional_columns</span>
                    <span class="p">)</span>
            <span class="n">diffmap</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">diffmap</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">additional_columns</span><span class="p">:</span>
                <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">additional_columns</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">diffmap</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">diffmap</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">diffmap</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="draw_graph"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.draw_graph.html#ehrapy.plot.draw_graph">[docs]</a><span class="nd">@_wraps_plot_scatter</span>
<span class="nd">@_doc_params</span><span class="p">(</span>
    <span class="n">adata_color_etc</span><span class="o">=</span><span class="n">doc_adata_color_etc</span><span class="p">,</span>
    <span class="n">edges_arrows</span><span class="o">=</span><span class="n">doc_edges_arrows</span><span class="p">,</span>
    <span class="n">scatter_bulk</span><span class="o">=</span><span class="n">doc_scatter_embedding</span><span class="p">,</span>
    <span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">draw_graph</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">layout</span><span class="p">:</span> <span class="n">_IGraphLayout</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Axes</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Scatter plot in graph-drawing basis.</span>

<span class="sd">    Args:</span>
<span class="sd">        {adata_color_etc}</span>
<span class="sd">        layout: One of the :func:`~scanpy.tl.draw_graph` layouts. By default, the last computed layout is used.</span>
<span class="sd">        {edges_arrows}</span>
<span class="sd">        {scatter_bulk}</span>
<span class="sd">        {show_save_ax}</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `show==False` a :class:`~matplotlib.axes.Axes` or a list of it.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.5, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.tl.paga(adata, groups=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.paga(</span>
<span class="sd">                adata,</span>
<span class="sd">                color=[&quot;leiden_0_5&quot;, &quot;day_28_flg&quot;],</span>
<span class="sd">                cmap=ep.pl.Colormaps.grey_red.value,</span>
<span class="sd">                title=[&quot;Leiden 0.5&quot;, &quot;Died in less than 28 days&quot;],</span>
<span class="sd">            )</span>
<span class="sd">            ep.tl.draw_graph(adata, init_pos=&quot;paga&quot;)</span>
<span class="sd">            ep.pl.draw_graph(adata, color=[&quot;leiden_0_5&quot;, &quot;icu_exp_flg&quot;], legend_loc=&quot;on data&quot;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/draw_graph_1.png</span>

<span class="sd">        .. image:: /_static/docstring_previews/draw_graph_2.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">draw_graph_part</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">draw_graph</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">MedCAT</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]]</span>
            <span class="n">additional_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">colored_column</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span> <span class="ow">and</span> <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">columns</span>
                <span class="p">):</span>
                    <span class="n">EhrapyMedcat</span><span class="o">.</span><span class="n">add_binary_column_to_obs</span><span class="p">(</span>
                        <span class="n">adata</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">colored_column</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span> <span class="n">additional_columns</span>
                    <span class="p">)</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="n">draw_graph_part</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">additional_columns</span><span class="p">:</span>
                <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">additional_columns</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">graph</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">draw_graph_part</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">draw_graph_part</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">Empty</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">token</span> <span class="o">=</span> <span class="mi">0</span>


<span class="n">_empty</span> <span class="o">=</span> <span class="n">Empty</span><span class="o">.</span><span class="n">token</span>


<div class="viewcode-block" id="spatial"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.spatial.html#ehrapy.plot.spatial">[docs]</a><span class="nd">@_wraps_plot_scatter</span>
<span class="nd">@_doc_params</span><span class="p">(</span>
    <span class="n">adata_color_etc</span><span class="o">=</span><span class="n">doc_adata_color_etc</span><span class="p">,</span>
    <span class="n">scatter_spatial</span><span class="o">=</span><span class="n">doc_scatter_spatial</span><span class="p">,</span>
    <span class="n">scatter_bulk</span><span class="o">=</span><span class="n">doc_scatter_embedding</span><span class="p">,</span>
    <span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">spatial</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">basis</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;spatial&quot;</span><span class="p">,</span>
    <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">img_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">Empty</span> <span class="o">=</span> <span class="n">_empty</span><span class="p">,</span>
    <span class="n">library_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Empty</span> <span class="o">=</span> <span class="n">_empty</span><span class="p">,</span>
    <span class="n">crop_coord</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">alpha_img</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">bw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">spot_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">na_color</span><span class="p">:</span> <span class="n">ColorLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Axes</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Scatter plot in spatial coordinates.</span>

<span class="sd">    This function allows overlaying data on top of images.</span>
<span class="sd">    Use the parameter `img_key` to see the image in the background</span>
<span class="sd">    And the parameter `library_id` to select the image.</span>
<span class="sd">    By default, `&#39;hires&#39;` and `&#39;lowres&#39;` are attempted.</span>
<span class="sd">    Use `crop_coord`, `alpha_img`, and `bw` to control how it is displayed.</span>
<span class="sd">    Use `size` to scale the size of the Visium spots plotted on top.</span>
<span class="sd">    As this function is designed to for imaging data, there are two key assumptions</span>
<span class="sd">    about how coordinates are handled:</span>

<span class="sd">    1. The origin (e.g `(0, 0)`) is at the top left  as is common convention</span>
<span class="sd">    with image data.</span>
<span class="sd">    2. Coordinates are in the pixel space of the source image, so an equal</span>
<span class="sd">    aspect ratio is assumed.</span>
<span class="sd">    If your anndata object has a `&quot;spatial&quot;` entry in `.uns`, the `img_key`</span>
<span class="sd">    and `library_id` parameters to find values for `img`, `scale_factor`,</span>
<span class="sd">    and `spot_size` arguments. Alternatively, these values be passed directly.</span>

<span class="sd">    Args:</span>
<span class="sd">        {adata_color_etc}</span>
<span class="sd">        {scatter_spatial}</span>
<span class="sd">        {scatter_bulk}</span>
<span class="sd">        {show_save_ax}</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `show==False` a :class:`~matplotlib.axes.Axes` or a list of it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">spatial</span><span class="p">(</span>
        <span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span>
        <span class="n">basis</span><span class="o">=</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">img</span><span class="o">=</span><span class="n">img</span><span class="p">,</span>
        <span class="n">img_key</span><span class="o">=</span><span class="n">img_key</span><span class="p">,</span>
        <span class="n">library_id</span><span class="o">=</span><span class="n">library_id</span><span class="p">,</span>
        <span class="n">crop_coord</span><span class="o">=</span><span class="n">crop_coord</span><span class="p">,</span>
        <span class="n">alpha_img</span><span class="o">=</span><span class="n">alpha_img</span><span class="p">,</span>
        <span class="n">bw</span><span class="o">=</span><span class="n">bw</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
        <span class="n">scale_factor</span><span class="o">=</span><span class="n">scale_factor</span><span class="p">,</span>
        <span class="n">spot_size</span><span class="o">=</span><span class="n">spot_size</span><span class="p">,</span>
        <span class="n">na_color</span><span class="o">=</span><span class="n">na_color</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">return_fig</span><span class="o">=</span><span class="n">return_fig</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="embedding"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.embedding.html#ehrapy.plot.embedding">[docs]</a><span class="nd">@_doc_params</span><span class="p">(</span>
    <span class="n">adata_color_etc</span><span class="o">=</span><span class="n">doc_adata_color_etc</span><span class="p">,</span>
    <span class="n">edges_arrows</span><span class="o">=</span><span class="n">doc_edges_arrows</span><span class="p">,</span>
    <span class="n">scatter_bulk</span><span class="o">=</span><span class="n">doc_scatter_embedding</span><span class="p">,</span>
    <span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">embedding</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">basis</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sort_order</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">edges</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">edges_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">edges_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;grey&quot;</span><span class="p">,</span>
    <span class="n">neighbors_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">arrows</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">arrows_kwds</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">groups</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">components</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">projection</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;2d&quot;</span><span class="p">,</span> <span class="s2">&quot;3d&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;2d&quot;</span><span class="p">,</span>
    <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">color_map</span><span class="p">:</span> <span class="n">Colormap</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cmap</span><span class="p">:</span> <span class="n">Colormap</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">palette</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Cycler</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">na_color</span><span class="p">:</span> <span class="n">ColorLike</span> <span class="o">=</span> <span class="s2">&quot;lightgray&quot;</span><span class="p">,</span>
    <span class="n">na_in_legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">frameon</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">_FontSize</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_fontweight</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">_FontWeight</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span><span class="p">,</span>
    <span class="n">legend_loc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;right margin&quot;</span><span class="p">,</span>
    <span class="n">legend_fontoutline</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vmax</span><span class="p">:</span> <span class="n">VBound</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">VBound</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vmin</span><span class="p">:</span> <span class="n">VBound</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">VBound</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vcenter</span><span class="p">:</span> <span class="n">VBound</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">VBound</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">norm</span><span class="p">:</span> <span class="n">Normalize</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Normalize</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">add_outline</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">outline_width</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
    <span class="n">outline_color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;white&quot;</span><span class="p">),</span>
    <span class="n">ncols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">hspace</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
    <span class="n">wspace</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Figure</span> <span class="o">|</span> <span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Scatter plot for user specified embedding basis (e.g. umap, pca, etc).</span>

<span class="sd">    Args:</span>
<span class="sd">        basis:</span>
<span class="sd">        {adata_color_etc}</span>
<span class="sd">        {edges_arrows}</span>
<span class="sd">        {scatter_bulk}</span>
<span class="sd">        {show_save_ax}</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `show==False` a :class:`~matplotlib.axes.Axes` or a list of it.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.umap(adata)</span>
<span class="sd">            ep.pl.embedding(adata, &#39;X_umap&#39;, color=&#39;icu_exp_flg&#39;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/embedding.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">embedding_partial</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">embedding</span><span class="p">,</span>
        <span class="n">basis</span><span class="o">=</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">gene_symbols</span><span class="o">=</span><span class="n">feature_symbols</span><span class="p">,</span>
        <span class="n">use_raw</span><span class="o">=</span><span class="n">use_raw</span><span class="p">,</span>
        <span class="n">sort_order</span><span class="o">=</span><span class="n">sort_order</span><span class="p">,</span>
        <span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span>
        <span class="n">edges_width</span><span class="o">=</span><span class="n">edges_width</span><span class="p">,</span>
        <span class="n">edges_color</span><span class="o">=</span><span class="n">edges_color</span><span class="p">,</span>
        <span class="n">neighbors_key</span><span class="o">=</span><span class="n">neighbors_key</span><span class="p">,</span>
        <span class="n">arrows</span><span class="o">=</span><span class="n">arrows</span><span class="p">,</span>
        <span class="n">arrows_kwds</span><span class="o">=</span><span class="n">arrows_kwds</span><span class="p">,</span>
        <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span>
        <span class="n">components</span><span class="o">=</span><span class="n">components</span><span class="p">,</span>
        <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span>
        <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span>
        <span class="n">scale_factor</span><span class="o">=</span><span class="n">scale_factor</span><span class="p">,</span>
        <span class="n">color_map</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">palette</span><span class="o">=</span><span class="n">palette</span><span class="p">,</span>
        <span class="n">na_color</span><span class="o">=</span><span class="n">na_color</span><span class="p">,</span>
        <span class="n">na_in_legend</span><span class="o">=</span><span class="n">na_in_legend</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
        <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span>
        <span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">,</span>
        <span class="n">legend_fontweight</span><span class="o">=</span><span class="n">legend_fontweight</span><span class="p">,</span>
        <span class="n">legend_loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">,</span>
        <span class="n">legend_fontoutline</span><span class="o">=</span><span class="n">legend_fontoutline</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
        <span class="n">vcenter</span><span class="o">=</span><span class="n">vcenter</span><span class="p">,</span>
        <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
        <span class="n">add_outline</span><span class="o">=</span><span class="n">add_outline</span><span class="p">,</span>
        <span class="n">outline_width</span><span class="o">=</span><span class="n">outline_width</span><span class="p">,</span>
        <span class="n">outline_color</span><span class="o">=</span><span class="n">outline_color</span><span class="p">,</span>
        <span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="p">,</span>
        <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">,</span>
        <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">return_fig</span><span class="o">=</span><span class="n">return_fig</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">MedCAT</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">color</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="n">color</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
            <span class="n">additional_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">colored_column</span> <span class="ow">in</span> <span class="n">color</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">var_names</span><span class="p">)</span> <span class="ow">and</span> <span class="n">colored_column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">columns</span>
                <span class="p">):</span>
                    <span class="n">EhrapyMedcat</span><span class="o">.</span><span class="n">add_binary_column_to_obs</span><span class="p">(</span>
                        <span class="n">adata</span><span class="p">,</span> <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">colored_column</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">additional_columns</span>  <span class="c1"># type: ignore</span>
                    <span class="p">)</span>
            <span class="n">_embedding</span> <span class="o">=</span> <span class="n">embedding_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">additional_columns</span><span class="p">:</span>
                <span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">additional_columns</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_embedding</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">embedding_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">anndata</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">embedding_partial</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span></div>


<div class="viewcode-block" id="embedding_density"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.embedding_density.html#ehrapy.plot.embedding_density">[docs]</a><span class="nd">@_doc_params</span><span class="p">(</span><span class="n">vminmax</span><span class="o">=</span><span class="n">doc_vbound_percentile</span><span class="p">,</span> <span class="n">panels</span><span class="o">=</span><span class="n">doc_panels</span><span class="p">,</span> <span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">embedding_density</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">basis</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;umap&quot;</span><span class="p">,</span>  <span class="c1"># was positional before 1.4.5</span>
    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># was positional before 1.4.5</span>
    <span class="n">groupby</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">group</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="n">color_map</span><span class="p">:</span> <span class="n">Colormap</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;YlOrRd&quot;</span><span class="p">,</span>
    <span class="n">bg_dotsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>
    <span class="n">fg_dotsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span>
    <span class="n">vmax</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">vmin</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">vcenter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">norm</span><span class="p">:</span> <span class="n">Normalize</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ncols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">hspace</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span>
    <span class="n">wspace</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Figure</span> <span class="o">|</span> <span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Plot the density of observations in an embedding (per condition).</span>

<span class="sd">    Plots the gaussian kernel density estimates (over condition) from the `sc.tl.embedding_density()` output. This currently</span>
<span class="sd">    does not support extracted medcat entities.</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: :class:`~anndata.AnnData` object object containing all observations.</span>
<span class="sd">        basis: The embedding over which the density was calculated.</span>
<span class="sd">               This embedded representation should be found in `adata.obsm[&#39;X_[basis]&#39;]``.</span>
<span class="sd">        key: Name of the `.obs` covariate that contains the density estimates. Alternatively, pass `groupby`.</span>
<span class="sd">        groupby: Name of the condition used in `tl.embedding_density`. Alternatively, pass `key`.</span>
<span class="sd">        group: The category in the categorical observation annotation to be plotted.</span>
<span class="sd">               If all categories are to be plotted use group=&#39;all&#39; (default), If multiple categories</span>
<span class="sd">               want to be plotted use a list (e.g.: [&#39;G1&#39;, &#39;S&#39;]. If the overall density wants to be ploted set group to &#39;None&#39;.</span>
<span class="sd">        color_map: Matplolib color map to use for density plotting.</span>
<span class="sd">        bg_dotsize: Dot size for background data points not in the `group`.</span>
<span class="sd">        fg_dotsize: Dot size for foreground data points in the `group`.</span>
<span class="sd">        vmin: The value representing the lower limit of the color scale. Values smaller than vmin are plotted</span>
<span class="sd">              with the same color as vmin. vmin can be a number, a string, a function or `None`. If</span>
<span class="sd">              vmin is a string and has the format `pN`, this is interpreted as a vmin=percentile(N).</span>
<span class="sd">              For example vmin=&#39;p1.5&#39; is interpreted as the 1.5 percentile. If vmin is function, then</span>
<span class="sd">              vmin is interpreted as the return value of the function over the list of values to plot.</span>
<span class="sd">              For example to set vmin tp the mean of the values to plot, `def my_vmin(values): return</span>
<span class="sd">              np.mean(values)` and then set `vmin=my_vmin`. If vmin is None (default) an automatic</span>
<span class="sd">              minimum value is used as defined by matplotlib `scatter` function. When making multiple</span>
<span class="sd">              plots, vmin can be a list of values, one for each plot. For example `vmin=[0.1, &#39;p1&#39;, None, my_vmin]`</span>
<span class="sd">        vmax: The value representing the upper limit of the color scale. The format is the same as for `vmin`.</span>
<span class="sd">        vcenter: The value representing the center of the color scale. Useful for diverging colormaps.</span>
<span class="sd">                 The format is the same as for `vmin`.</span>
<span class="sd">                 Example: sc.pl.umap(adata, color=&#39;TREM2&#39;, vcenter=&#39;p50&#39;, cmap=&#39;RdBu_r&#39;)</span>
<span class="sd">        ncols: Number of panels per row.</span>
<span class="sd">        wspace: Adjust the width of the space between multiple panels.</span>
<span class="sd">        hspace: Adjust the height of the space between multiple panels.</span>
<span class="sd">        return_fig: Return the matplotlib figure.\</span>
<span class="sd">        {show_save_ax}</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `show==False` a :class:`~matplotlib.axes.Axes` or a list of it.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.umap(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.5, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.tl.embedding_density(adata, groupby=&#39;leiden_0_5&#39;, key_added=&#39;icu_exp_flg&#39;)</span>
<span class="sd">            ep.pl.embedding_density(adata, key=&#39;icu_exp_flg&#39;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/embedding_density.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">embedding_density</span><span class="p">(</span>
        <span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span>
        <span class="n">basis</span><span class="o">=</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">,</span>
        <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span>
        <span class="n">color_map</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span>
        <span class="n">bg_dotsize</span><span class="o">=</span><span class="n">bg_dotsize</span><span class="p">,</span>
        <span class="n">fg_dotsize</span><span class="o">=</span><span class="n">fg_dotsize</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
        <span class="n">vcenter</span><span class="o">=</span><span class="n">vcenter</span><span class="p">,</span>
        <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
        <span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="p">,</span>
        <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">,</span>
        <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">return_fig</span><span class="o">=</span><span class="n">return_fig</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="dpt_groups_pseudotime"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.dpt_groups_pseudotime.html#ehrapy.plot.dpt_groups_pseudotime">[docs]</a><span class="k">def</span> <span class="nf">dpt_groups_pseudotime</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">color_map</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Colormap</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">palette</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Cycler</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Plot groups and pseudotime.</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: :class:`~anndata.AnnData` object object containing all observations.</span>
<span class="sd">        color_map: Matplotlib Colormap</span>
<span class="sd">        palette: Matplotlib color Palette</span>
<span class="sd">        show: Whether to show the plot.</span>
<span class="sd">        save: Whether to save the plot or a path to save the plot.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>
<span class="sd">            import numpy as np</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata, method=&#39;gauss&#39;)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.5, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.tl.diffmap(adata, n_comps=10)</span>
<span class="sd">            adata.uns[&#39;iroot&#39;] = np.flatnonzero(adata.obs[&#39;leiden_0_5&#39;] == &#39;0&#39;)[0]</span>
<span class="sd">            ep.tl.dpt(adata, n_branchings=3)</span>
<span class="sd">            ep.pl.dpt_groups_pseudotime(adata)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/dpt_groups_pseudotime.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">dpt_groups_pseudotime</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">palette</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">)</span></div>


<div class="viewcode-block" id="dpt_timeseries"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.dpt_timeseries.html#ehrapy.plot.dpt_timeseries">[docs]</a><span class="k">def</span> <span class="nf">dpt_timeseries</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">color_map</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Colormap</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">as_heatmap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Heatmap of pseudotime series.</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: :class:`~anndata.AnnData` object object containing all observations.</span>
<span class="sd">        color_map: Matplotlib Colormap</span>
<span class="sd">        as_heatmap: Whether to render the plot a heatmap</span>
<span class="sd">        show: Whether to show the plot.</span>
<span class="sd">        save: Whether to save the plot or a path to save the plot.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            import numpy as np</span>
<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata, method=&#39;gauss&#39;)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.5, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.tl.diffmap(adata, n_comps=10)</span>
<span class="sd">            adata.uns[&#39;iroot&#39;] = np.flatnonzero(adata.obs[&#39;leiden_0_5&#39;] == &#39;0&#39;)[0]</span>
<span class="sd">            ep.tl.dpt(adata, n_branchings=3)</span>
<span class="sd">            ep.pl.dpt_timeseries(adata)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/dpt_timeseries.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">dpt_timeseries</span><span class="p">(</span><span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span> <span class="n">as_heatmap</span><span class="o">=</span><span class="n">as_heatmap</span><span class="p">)</span></div>


<div class="viewcode-block" id="paga"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.paga.html#ehrapy.plot.paga">[docs]</a><span class="k">def</span> <span class="nf">paga</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layout</span><span class="p">:</span> <span class="n">_IGraphLayout</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">layout_kwds</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">MappingProxyType</span><span class="p">({}),</span>
    <span class="n">init_pos</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">root</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">single_component</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">solid_edges</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;connectivities&quot;</span><span class="p">,</span>
    <span class="n">dashed_edges</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">transitions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fontweight</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span><span class="p">,</span>
    <span class="n">fontoutline</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">text_kwds</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">MappingProxyType</span><span class="p">({}),</span>
    <span class="n">node_size_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">node_size_power</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">edge_width_scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">min_edge_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_edge_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">arrowsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">left_margin</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">pos</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">normalize_to_color</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">cmap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Colormap</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cax</span><span class="p">:</span> <span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cb_kwds</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">MappingProxyType</span><span class="p">({}),</span>
    <span class="n">frameon</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">add_pos</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">export_to_gexf</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">use_raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Axes</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Plot the PAGA graph through thresholding low-connectivity edges.</span>

<span class="sd">    Compute a coarse-grained layout of the data. Reuse this by passing</span>
<span class="sd">    `init_pos=&#39;paga&#39;` to :func:`~scanpy.tl.umap` or</span>
<span class="sd">    :func:`~scanpy.tl.draw_graph` and obtain embeddings with more meaningful</span>
<span class="sd">    global topology [Wolf19]_.</span>
<span class="sd">    This uses ForceAtlas2 or igraph&#39;s layout algorithms for most layouts [Csardi06]_.</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: :class:`~anndata.AnnData` object object containing all observations.</span>
<span class="sd">        threshold: Do not draw edges for weights below this threshold. Set to 0 if you want</span>
<span class="sd">                   all edges. Discarding low-connectivity edges helps in getting a much clearer picture of the graph.</span>
<span class="sd">        color: Feature name or `obs` annotation defining the node colors.</span>
<span class="sd">               Also plots the degree of the abstracted graph when</span>
<span class="sd">               passing {`&#39;degree_dashed&#39;`, `&#39;degree_solid&#39;`}.</span>
<span class="sd">               Can be also used to visualize pie chart at each node in the following form:</span>
<span class="sd">               `{&lt;group name or index&gt;: {&lt;color&gt;: &lt;fraction&gt;, ...}, ...}`. If the fractions</span>
<span class="sd">               do not sum to 1, a new category called `&#39;rest&#39;` colored grey will be created.</span>
<span class="sd">        layout: The node labels. If `None`, this defaults to the group labels stored in</span>
<span class="sd">                the categorical for which :func:`~scanpy.tl.paga` has been computed.</span>
<span class="sd">        layout_kwds: Keywords for the layout.</span>
<span class="sd">        init_pos: Two-column array storing the x and y coordinates for initializing the layout.</span>
<span class="sd">        root: If choosing a tree layout, this is the index of the root node or a list</span>
<span class="sd">              of root node indices. If this is a non-empty vector then the supplied</span>
<span class="sd">              node IDs are used as the roots of the trees (or a single tree if the</span>
<span class="sd">              graph is connected). If this is `None` or an empty list, the root</span>
<span class="sd">              vertices are automatically calculated based on topological sorting.</span>
<span class="sd">        labels: The node labels. If `None`, this defaults to the group labels stored in</span>
<span class="sd">                the categorical for which :func:`~scanpy.tl.paga` has been computed.</span>
<span class="sd">        single_component: Restrict to largest connected component.</span>
<span class="sd">        solid_edges: Key for `.uns[&#39;paga&#39;]` that specifies the matrix that stores the edges to be drawn solid black.</span>
<span class="sd">        dashed_edges: Key for `.uns[&#39;paga&#39;]` that specifies the matrix that stores the edges</span>
<span class="sd">                      to be drawn dashed grey. If `None`, no dashed edges are drawn.</span>
<span class="sd">        transitions: Key for `.uns[&#39;paga&#39;]` that specifies the matrix that stores the</span>
<span class="sd">                     arrows, for instance `&#39;transitions_confidence&#39;`.</span>
<span class="sd">        fontsize: Font size for node labels.</span>
<span class="sd">        fontweight: Weight of the font.</span>
<span class="sd">        fontoutline: Width of the white outline around fonts.</span>
<span class="sd">        text_kwds: Keywords for :meth:`~matplotlib.axes.Axes.text`.</span>
<span class="sd">        node_size_scale: Increase or decrease the size of the nodes.</span>
<span class="sd">        node_size_power: The power with which groups sizes influence the radius of the nodes.</span>
<span class="sd">        edge_width_scale: Edge with scale in units of `rcParams[&#39;lines.linewidth&#39;]`.</span>
<span class="sd">        min_edge_width: Min width of solid edges.</span>
<span class="sd">        max_edge_width: Max width of solid and dashed edges.</span>
<span class="sd">        arrowsize: For directed graphs, choose the size of the arrow head head&#39;s length and width.</span>
<span class="sd">                   See :py:class: `matplotlib.patches.FancyArrowPatch` for attribute `mutation_scale` for more info.</span>
<span class="sd">        title: Provide a title.</span>
<span class="sd">        left_margin: Margin to the left of the plot.</span>
<span class="sd">        random_state: For layouts with random initialization like `&#39;fr&#39;`, change this to use</span>
<span class="sd">                      different intial states for the optimization. If `None`, the initial state is not reproducible.</span>
<span class="sd">        pos: Two-column array-like storing the x and y coordinates for drawing.</span>
<span class="sd">             Otherwise, path to a `.gdf` file that has been exported from Gephi or</span>
<span class="sd">             a similar graph visualization software.</span>
<span class="sd">        normalize_to_color: Whether to normalize categorical plots to `color` or the underlying grouping.</span>
<span class="sd">        cmap: The Matplotlib color map.</span>
<span class="sd">        cax: A matplotlib axes object for a potential colorbar.</span>
<span class="sd">        cb_kwds: Keyword arguments for :class:`~matplotlib.colorbar.ColorbarBase`, for instance, `ticks`.</span>
<span class="sd">        frameon: Draw a frame around the PAGA graph.</span>
<span class="sd">        add_pos: Add the positions to `adata.uns[&#39;paga&#39;]`.</span>
<span class="sd">        export_to_gexf: Export to gexf format to be read by graph visualization programs such as Gephi.</span>
<span class="sd">        use_raw: Whether to use `raw` attribute of `adata`. Defaults to `True` if `.raw` is present.</span>
<span class="sd">        plot: If `False`, do not create the figure, simply compute the layout.</span>
<span class="sd">        ax: Matplotlib Axis object.</span>
<span class="sd">        show: Whether to show the plot.</span>
<span class="sd">        save: Whether or where to save the plot.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A :class:`~matplotlib.axes.Axes` object, if `ax` is `None`, else `None`.</span>
<span class="sd">        If `return_data`, return the timeseries data in addition to an axes.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.5, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.tl.paga(adata, groups=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.paga(</span>
<span class="sd">                adata,</span>
<span class="sd">                color=[&quot;leiden_0_5&quot;, &quot;day_28_flg&quot;],</span>
<span class="sd">                cmap=ep.pl.Colormaps.grey_red.value,</span>
<span class="sd">                title=[&quot;Leiden 0.5&quot;, &quot;Died in less than 28 days&quot;],</span>
<span class="sd">            )</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/paga.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">paga</span><span class="p">(</span>
        <span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span>
        <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
        <span class="n">layout_kwds</span><span class="o">=</span><span class="n">layout_kwds</span><span class="p">,</span>
        <span class="n">init_pos</span><span class="o">=</span><span class="n">init_pos</span><span class="p">,</span>
        <span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">single_component</span><span class="o">=</span><span class="n">single_component</span><span class="p">,</span>
        <span class="n">solid_edges</span><span class="o">=</span><span class="n">solid_edges</span><span class="p">,</span>
        <span class="n">dashed_edges</span><span class="o">=</span><span class="n">dashed_edges</span><span class="p">,</span>
        <span class="n">transitions</span><span class="o">=</span><span class="n">transitions</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
        <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">,</span>
        <span class="n">fontoutline</span><span class="o">=</span><span class="n">fontoutline</span><span class="p">,</span>
        <span class="n">text_kwds</span><span class="o">=</span><span class="n">text_kwds</span><span class="p">,</span>
        <span class="n">node_size_scale</span><span class="o">=</span><span class="n">node_size_scale</span><span class="p">,</span>
        <span class="n">node_size_power</span><span class="o">=</span><span class="n">node_size_power</span><span class="p">,</span>
        <span class="n">edge_width_scale</span><span class="o">=</span><span class="n">edge_width_scale</span><span class="p">,</span>
        <span class="n">min_edge_width</span><span class="o">=</span><span class="n">min_edge_width</span><span class="p">,</span>
        <span class="n">max_edge_width</span><span class="o">=</span><span class="n">max_edge_width</span><span class="p">,</span>
        <span class="n">arrowsize</span><span class="o">=</span><span class="n">arrowsize</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">left_margin</span><span class="o">=</span><span class="n">left_margin</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
        <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
        <span class="n">normalize_to_color</span><span class="o">=</span><span class="n">normalize_to_color</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span>
        <span class="n">cb_kwds</span><span class="o">=</span><span class="n">cb_kwds</span><span class="p">,</span>
        <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span>
        <span class="n">add_pos</span><span class="o">=</span><span class="n">add_pos</span><span class="p">,</span>
        <span class="n">export_to_gexf</span><span class="o">=</span><span class="n">export_to_gexf</span><span class="p">,</span>
        <span class="n">use_raw</span><span class="o">=</span><span class="n">use_raw</span><span class="p">,</span>
        <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="paga_path"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.paga_path.html#ehrapy.plot.paga_path">[docs]</a><span class="k">def</span> <span class="nf">paga_path</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">nodes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">],</span>
    <span class="n">keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">use_raw</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">annotations</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;dpt_pseudotime&quot;</span><span class="p">,),</span>
    <span class="n">color_map</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Colormap</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">color_maps_annotations</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Colormap</span><span class="p">]</span> <span class="o">=</span> <span class="n">MappingProxyType</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">dpt_pseudotime</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">)),</span>  <span class="c1"># noqa: B006</span>
    <span class="n">palette_groups</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">n_avg</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">groups_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">xlim</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">left_margin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ytick_fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">title_fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show_node_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_yticks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_colorbar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">_FontSize</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_fontweight</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">_FontWeight</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">normalize_to_zero_one</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">as_heatmap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">return_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Feature changes along paths in the abstracted graph.</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: :class:`~anndata.AnnData` object object containing all observations.</span>
<span class="sd">        nodes: A path through nodes of the abstracted graph, that is, names or indices</span>
<span class="sd">               (within `.categories`) of groups that have been used to run PAGA.</span>
<span class="sd">        keys: Either variables in `adata.var_names` or annotations in `adata.obs`. They are plotted using `color_map`.</span>
<span class="sd">        use_raw: Use `adata.raw` for retrieving feature values if it has been set.</span>
<span class="sd">        annotations: Plot these keys with `color_maps_annotations`. Need to be keys for `adata.obs`.</span>
<span class="sd">        color_map: Matplotlib colormap.</span>
<span class="sd">        color_maps_annotations: Color maps for plotting the annotations. Keys of the dictionary must appear in `annotations`.</span>
<span class="sd">        palette_groups: Usually, use the same `sc.pl.palettes...` as used for coloring the abstracted graph.</span>
<span class="sd">        n_avg: Number of data points to include in computation of running average.</span>
<span class="sd">        groups_key: Key of the grouping used to run PAGA. If `None`, defaults to `adata.uns[&#39;paga&#39;][&#39;groups&#39;]`.</span>
<span class="sd">        xlim: Matplotlib x limit.</span>
<span class="sd">        title: Plot title.</span>
<span class="sd">        left_margin: Margin to the left of the plot.</span>
<span class="sd">        ytick_fontsize: Matplotlib ytick fontsize.</span>
<span class="sd">        title_fontsize: Font size of the title.</span>
<span class="sd">        show_node_names: Whether to plot the node names on the nodes bar.</span>
<span class="sd">        show_yticks: Whether to show the y axis ticks.</span>
<span class="sd">        show_colorbar: Whether to show the color bar.</span>
<span class="sd">        legend_fontsize: Font size of the legend.</span>
<span class="sd">        legend_fontweight: Font weight of the legend.</span>
<span class="sd">        normalize_to_zero_one: Shift and scale the running average to [0, 1] per feature.</span>
<span class="sd">        as_heatmap: Whether to display the plot as heatmap.</span>
<span class="sd">        return_data: Whether to return the timeseries data in addition to the axes if `True`.</span>
<span class="sd">        ax: Matplotlib Axis object.</span>
<span class="sd">        show: Whether to show the plot.</span>
<span class="sd">        save: Whether or where to save the plot.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A :class:`~matplotlib.axes.Axes` object, if `ax` is `None`, else `None`.</span>
<span class="sd">        If `return_data`, return the timeseries data in addition to an axes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">paga_path</span><span class="p">(</span>
        <span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span>
        <span class="n">nodes</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span>
        <span class="n">keys</span><span class="o">=</span><span class="n">keys</span><span class="p">,</span>
        <span class="n">use_raw</span><span class="o">=</span><span class="n">use_raw</span><span class="p">,</span>
        <span class="n">annotations</span><span class="o">=</span><span class="n">annotations</span><span class="p">,</span>
        <span class="n">color_map</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span>
        <span class="n">color_maps_annotations</span><span class="o">=</span><span class="n">color_maps_annotations</span><span class="p">,</span>
        <span class="n">palette_groups</span><span class="o">=</span><span class="n">palette_groups</span><span class="p">,</span>
        <span class="n">n_avg</span><span class="o">=</span><span class="n">n_avg</span><span class="p">,</span>
        <span class="n">groups_key</span><span class="o">=</span><span class="n">groups_key</span><span class="p">,</span>
        <span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">left_margin</span><span class="o">=</span><span class="n">left_margin</span><span class="p">,</span>
        <span class="n">ytick_fontsize</span><span class="o">=</span><span class="n">ytick_fontsize</span><span class="p">,</span>
        <span class="n">title_fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span>
        <span class="n">show_node_names</span><span class="o">=</span><span class="n">show_node_names</span><span class="p">,</span>
        <span class="n">show_yticks</span><span class="o">=</span><span class="n">show_yticks</span><span class="p">,</span>
        <span class="n">show_colorbar</span><span class="o">=</span><span class="n">show_colorbar</span><span class="p">,</span>
        <span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">,</span>
        <span class="n">legend_fontweight</span><span class="o">=</span><span class="n">legend_fontweight</span><span class="p">,</span>
        <span class="n">normalize_to_zero_one</span><span class="o">=</span><span class="n">normalize_to_zero_one</span><span class="p">,</span>
        <span class="n">as_heatmap</span><span class="o">=</span><span class="n">as_heatmap</span><span class="p">,</span>
        <span class="n">return_data</span><span class="o">=</span><span class="n">return_data</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="paga_compare"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.paga_compare.html#ehrapy.plot.paga_compare">[docs]</a><span class="k">def</span> <span class="nf">paga_compare</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">basis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">groups</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">components</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">projection</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;2d&quot;</span><span class="p">,</span> <span class="s2">&quot;3d&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;2d&quot;</span><span class="p">,</span>
    <span class="n">legend_loc</span><span class="o">=</span><span class="s2">&quot;on data&quot;</span><span class="p">,</span>
    <span class="n">legend_fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">_FontSize</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_fontweight</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">_FontWeight</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span><span class="p">,</span>
    <span class="n">legend_fontoutline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">color_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">palette</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">right_margin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">left_margin</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">show</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title_graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">groups_graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">paga_graph_params</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Scatter and PAGA graph side-by-side.</span>

<span class="sd">    Consists in a scatter plot and the abstracted graph. See :func:`~ehrapy.pl.paga` for all related parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: :class:`~anndata.AnnData` object object containing all observations.</span>
<span class="sd">        basis: String that denotes a plotting tool that computed coordinates.</span>
<span class="sd">        edges: Whether to display edges.</span>
<span class="sd">        color: Keys for annotations of observations/patients or features, or a hex color specification, e.g.,</span>
<span class="sd">               `&#39;ann1&#39;`, `&#39;#fe57a1&#39;`, or `[&#39;ann1&#39;, &#39;ann2&#39;]`.</span>
<span class="sd">        alpha: Alpha value for the image</span>
<span class="sd">        groups: Key of the grouping used to run PAGA. If `None`, defaults to `adata.uns[&#39;paga&#39;][&#39;groups&#39;]`.</span>
<span class="sd">        components: For example, ``&#39;1,2,3&#39;`` means ``[1, 2, 3]``, first, second, third principal component.</span>
<span class="sd">        projection: One of &#39;2d&#39; or &#39;3d&#39;</span>
<span class="sd">        legend_loc: Location of the legend.</span>
<span class="sd">        legend_fontsize: Font size of the legend.</span>
<span class="sd">        legend_fontweight: Font weight of the legend.</span>
<span class="sd">        legend_fontoutline: Font outline of the legend.</span>
<span class="sd">        color_map: Matplotlib color map.</span>
<span class="sd">        palette: Matplotlib color palette.</span>
<span class="sd">        frameon: Whether to display the labels frameon.</span>
<span class="sd">        size: Size of the plot.</span>
<span class="sd">        title: Title of the plot.</span>
<span class="sd">        right_margin: Margin to the right of the plot.</span>
<span class="sd">        left_margin: Margin to the left of the plot.</span>
<span class="sd">        show: Whether to show the plot.</span>
<span class="sd">        save: Whether or where to save the plot.</span>
<span class="sd">        title_graph: The title of the graph.</span>
<span class="sd">        groups_graph: Graph labels.</span>
<span class="sd">        pos: Position of the plot.</span>
<span class="sd">        **paga_graph_params: Keywords for :func:`~ehrapy.pl.paga` and keywords for :func:`~ehrapy.pl.scatter`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Matplotlib axes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">paga_compare</span><span class="p">(</span>
        <span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span>
        <span class="n">basis</span><span class="o">=</span><span class="n">basis</span><span class="p">,</span>
        <span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
        <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span>
        <span class="n">components</span><span class="o">=</span><span class="n">components</span><span class="p">,</span>
        <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span>
        <span class="n">legend_loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">,</span>
        <span class="n">legend_fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">,</span>
        <span class="n">legend_fontweight</span><span class="o">=</span><span class="n">legend_fontweight</span><span class="p">,</span>
        <span class="n">legend_fontoutline</span><span class="o">=</span><span class="n">legend_fontoutline</span><span class="p">,</span>
        <span class="n">color_map</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span>
        <span class="n">palette</span><span class="o">=</span><span class="n">palette</span><span class="p">,</span>
        <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">right_margin</span><span class="o">=</span><span class="n">right_margin</span><span class="p">,</span>
        <span class="n">left_margin</span><span class="o">=</span><span class="n">left_margin</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="n">title_graph</span><span class="o">=</span><span class="n">title_graph</span><span class="p">,</span>
        <span class="n">groups_graph</span><span class="o">=</span><span class="n">groups_graph</span><span class="p">,</span>
        <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="o">**</span><span class="n">paga_graph_params</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="rank_features_groups"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.rank_features_groups.html#ehrapy.plot.rank_features_groups">[docs]</a><span class="nd">@_doc_params</span><span class="p">(</span><span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">rank_features_groups</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">groups</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">feature_symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;rank_features_groups&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">ncols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">share_y</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Plot ranking of features.</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: Annotated data matrix.</span>
<span class="sd">        groups: The groups for which to show the feature ranking.</span>
<span class="sd">        n_features: The number of features to plot.</span>
<span class="sd">        feature_symbols: Key for field in `.var` that stores feature symbols if you do not want to use `.var_names`.</span>
<span class="sd">        key: The key of the calculated feature group rankings (default: &#39;rank_features_groups&#39;).</span>
<span class="sd">        fontsize: Fontsize for feature names.</span>
<span class="sd">        ncols: Number of panels shown per row.</span>
<span class="sd">        share_y: Controls if the y-axis of each panels should be shared.</span>
<span class="sd">                 But passing `sharey=False`, each panel has its own y-axis range.</span>
<span class="sd">        {show_save_ax}</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.15, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.tl.rank_features_groups(adata, groupby=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.rank_features_groups(adata, key=&quot;rank_features_groups&quot;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/rank_features_groups.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">rank_genes_groups</span><span class="p">(</span>
        <span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span>
        <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span>
        <span class="n">n_genes</span><span class="o">=</span><span class="n">n_features</span><span class="p">,</span>
        <span class="n">gene_symbols</span><span class="o">=</span><span class="n">feature_symbols</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
        <span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="p">,</span>
        <span class="n">sharey</span><span class="o">=</span><span class="n">share_y</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="rank_features_groups_violin"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.rank_features_groups_violin.html#ehrapy.plot.rank_features_groups_violin">[docs]</a><span class="nd">@_doc_params</span><span class="p">(</span><span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">rank_features_groups_violin</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">groups</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">feature_names</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">split</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">scale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;width&quot;</span><span class="p">,</span>
    <span class="n">strip</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">jitter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Plot ranking of features for all tested comparisons as violin plots.</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: Annotated data matrix.</span>
<span class="sd">        groups: List of group names.</span>
<span class="sd">        n_features: Number of features to show. Is ignored if `feature_names` is passed.</span>
<span class="sd">        feature_names: List of features to plot. Is only useful if interested in a custom feature list,</span>
<span class="sd">                       which is not the result of :func:`ehrapy.tl.rank_features_groups`.</span>
<span class="sd">        feature_symbols: Key for field in `.var` that stores feature symbols if you do not want to</span>
<span class="sd">                         use `.var_names` displayed in the plot.</span>
<span class="sd">        key: The key of the calculated feature group rankings (default: &#39;rank_features_groups&#39;).</span>
<span class="sd">        split: Whether to split the violins or not.</span>
<span class="sd">        scale: See :func:`~seaborn.violinplot`.</span>
<span class="sd">        strip: Show a strip plot on top of the violin plot.</span>
<span class="sd">        jitter: If set to 0, no points are drawn. See :func:`~seaborn.stripplot`.</span>
<span class="sd">        size: Size of the jitter points.</span>
<span class="sd">        {show_save_ax}</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.15, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.tl.rank_features_groups(adata, groupby=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.rank_features_groups_violin(adata, key=&quot;rank_features_groups&quot;, n_features=5)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/rank_features_groups_violin_1.png</span>

<span class="sd">        .. image:: /_static/docstring_previews/rank_features_groups_violin_2.png</span>

<span class="sd">        .. image:: /_static/docstring_previews/rank_features_groups_violin_3.png</span>

<span class="sd">        .. image:: /_static/docstring_previews/rank_features_groups_violin_4.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">rank_genes_groups_violin</span><span class="p">(</span>
        <span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span>
        <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span>
        <span class="n">n_genes</span><span class="o">=</span><span class="n">n_features</span><span class="p">,</span>
        <span class="n">gene_names</span><span class="o">=</span><span class="n">feature_names</span><span class="p">,</span>
        <span class="n">gene_symbols</span><span class="o">=</span><span class="n">feature_symbols</span><span class="p">,</span>
        <span class="n">use_raw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
        <span class="n">split</span><span class="o">=</span><span class="n">split</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
        <span class="n">strip</span><span class="o">=</span><span class="n">strip</span><span class="p">,</span>
        <span class="n">jitter</span><span class="o">=</span><span class="n">jitter</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="rank_features_groups_stacked_violin"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.rank_features_groups_stacked_violin.html#ehrapy.plot.rank_features_groups_stacked_violin">[docs]</a><span class="nd">@_doc_params</span><span class="p">(</span><span class="n">show_save_ax</span><span class="o">=</span><span class="n">doc_show_save_ax</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">rank_features_groups_stacked_violin</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">groups</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">groupby</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">var_names</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_logfoldchange</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Plot ranking of genes using stacked_violin plot.</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: Annotated data matrix.</span>
<span class="sd">        groups: List of group names.</span>
<span class="sd">        n_features: Number of features to show. Is ignored if `feature_names` is passed.</span>
<span class="sd">        groupby: Which key to group the features by.</span>
<span class="sd">        feature_symbols: Key for field in `.var` that stores feature symbols if you do not want to</span>
<span class="sd">                         use `.var_names` displayed in the plot.</span>
<span class="sd">        var_names: Feature names.</span>
<span class="sd">        min_logfoldchange: Minimum log fold change to consider.</span>
<span class="sd">        key: The key of the calculated feature group rankings (default: &#39;rank_features_groups&#39;).</span>
<span class="sd">        show: Whether to show the plot.</span>
<span class="sd">        save: Where to save the plot.</span>
<span class="sd">        return_fig: Returns :class:`StackedViolin` object. Useful for fine-tuning the plot.</span>
<span class="sd">                    Takes precedence over `show=False`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `return_fig` is `True`, returns a :class:`StackedViolin` object,</span>
<span class="sd">        else if `show` is false, return axes dict</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.15, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.tl.rank_features_groups(adata, groupby=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.rank_features_groups_stacked_violin(adata, key=&quot;rank_features_groups&quot;, n_features=5)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/rank_features_groups_stacked_violin.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">rank_genes_groups_stacked_violin</span><span class="p">(</span>
        <span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span>
        <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span>
        <span class="n">n_genes</span><span class="o">=</span><span class="n">n_features</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">,</span>
        <span class="n">gene_symbols</span><span class="o">=</span><span class="n">feature_symbols</span><span class="p">,</span>
        <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
        <span class="n">min_logfoldchange</span><span class="o">=</span><span class="n">min_logfoldchange</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="n">return_fig</span><span class="o">=</span><span class="n">return_fig</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="rank_features_groups_heatmap"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.rank_features_groups_heatmap.html#ehrapy.plot.rank_features_groups_heatmap">[docs]</a><span class="k">def</span> <span class="nf">rank_features_groups_heatmap</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">groups</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">groupby</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_names</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_logfoldchange</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Plot ranking of genes using heatmap plot (see :func:`~ehrapy.pl.heatmap`)</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: Annotated data matrix.</span>
<span class="sd">        groups: List of group names.</span>
<span class="sd">        n_features: Number of features to show. Is ignored if `feature_names` is passed.</span>
<span class="sd">        groupby: Which key to group the features by.</span>
<span class="sd">        feature_symbols: Key for field in `.var` that stores feature symbols if you do not want to</span>
<span class="sd">                         use `.var_names` displayed in the plot.</span>
<span class="sd">        var_names: Feature names.</span>
<span class="sd">        min_logfoldchange: Minimum log fold change to consider.</span>
<span class="sd">        key: The key of the calculated feature group rankings (default: &#39;rank_features_groups&#39;).</span>
<span class="sd">        show: Whether to show the plot.</span>
<span class="sd">        save: Where to save the plot.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.15, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.tl.rank_features_groups(adata, groupby=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.rank_features_groups_heatmap(adata, key=&quot;rank_features_groups&quot;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/rank_features_groups_heatmap.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">rank_genes_groups_heatmap</span><span class="p">(</span>
        <span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span>
        <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span>
        <span class="n">n_genes</span><span class="o">=</span><span class="n">n_features</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">,</span>
        <span class="n">gene_symbols</span><span class="o">=</span><span class="n">feature_symbols</span><span class="p">,</span>
        <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
        <span class="n">min_logfoldchange</span><span class="o">=</span><span class="n">min_logfoldchange</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="rank_features_groups_dotplot"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.rank_features_groups_dotplot.html#ehrapy.plot.rank_features_groups_dotplot">[docs]</a><span class="k">def</span> <span class="nf">rank_features_groups_dotplot</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">groups</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">groupby</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">values_to_plot</span><span class="p">:</span> <span class="kc">None</span>
    <span class="o">|</span> <span class="p">(</span>
        <span class="n">Literal</span><span class="p">[</span>
            <span class="s2">&quot;scores&quot;</span><span class="p">,</span>
            <span class="s2">&quot;logfoldchanges&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pvals&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pvals_adj&quot;</span><span class="p">,</span>
            <span class="s2">&quot;log10_pvals&quot;</span><span class="p">,</span>
            <span class="s2">&quot;log10_pvals_adj&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_names</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_logfoldchange</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Plot ranking of genes using dotplot plot (see :func:`~ehrapy.pl.dotplot`)</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: Annotated data matrix.</span>
<span class="sd">        groups: List of group names.</span>
<span class="sd">        n_features: Number of features to show. Is ignored if `feature_names` is passed.</span>
<span class="sd">        groupby: Which key to group the features by.</span>
<span class="sd">        feature_symbols: Key for field in `.var` that stores feature symbols if you do not want to</span>
<span class="sd">                         use `.var_names` displayed in the plot.</span>
<span class="sd">        values_to_plot: Key to plot. One of &#39;scores&#39;, &#39;logfoldchanges&#39;, &#39;pvals&#39;, &#39;pvalds_adj&#39;,</span>
<span class="sd">                        &#39;log10_pvals&#39;, &#39;log10_pvalds_adj&#39;.</span>
<span class="sd">        var_names: Feature names.</span>
<span class="sd">        min_logfoldchange: Minimum log fold change to consider.</span>
<span class="sd">        key: The key of the calculated feature group rankings (default: &#39;rank_features_groups&#39;).</span>
<span class="sd">        show: Whether to show the plot.</span>
<span class="sd">        save: Where to save the plot.</span>
<span class="sd">        return_fig: Returns :class:`StackedViolin` object. Useful for fine-tuning the plot.</span>
<span class="sd">                    Takes precedence over `show=False`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `return_fig` is `True`, returns a :class:`StackedViolin` object,</span>
<span class="sd">        else if `show` is false, return axes dict</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.5, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.tl.rank_features_groups(adata, groupby=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.rank_features_groups_dotplot(adata, key=&quot;rank_features_groups&quot;, groupby=&quot;leiden_0_5&quot;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/rank_features_groups_dotplot.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">rank_genes_groups_dotplot</span><span class="p">(</span>
        <span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span>
        <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span>
        <span class="n">n_genes</span><span class="o">=</span><span class="n">n_features</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">,</span>
        <span class="n">values_to_plot</span><span class="o">=</span><span class="n">values_to_plot</span><span class="p">,</span>
        <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
        <span class="n">gene_symbols</span><span class="o">=</span><span class="n">feature_symbols</span><span class="p">,</span>
        <span class="n">min_logfoldchange</span><span class="o">=</span><span class="n">min_logfoldchange</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="n">return_fig</span><span class="o">=</span><span class="n">return_fig</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="rank_features_groups_matrixplot"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.rank_features_groups_matrixplot.html#ehrapy.plot.rank_features_groups_matrixplot">[docs]</a><span class="k">def</span> <span class="nf">rank_features_groups_matrixplot</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">groups</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">groupby</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">values_to_plot</span><span class="p">:</span> <span class="kc">None</span>
    <span class="o">|</span> <span class="p">(</span>
        <span class="n">Literal</span><span class="p">[</span>
            <span class="s2">&quot;scores&quot;</span><span class="p">,</span>
            <span class="s2">&quot;logfoldchanges&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pvals&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pvals_adj&quot;</span><span class="p">,</span>
            <span class="s2">&quot;log10_pvals&quot;</span><span class="p">,</span>
            <span class="s2">&quot;log10_pvals_adj&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_names</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_logfoldchange</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;rank_features_groups&quot;</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_fig</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Plot ranking of genes using matrixplot plot (see :func:`~ehrapy.pl.matrixplot`)</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: Annotated data matrix.</span>
<span class="sd">        groups: List of group names.</span>
<span class="sd">        n_features: Number of features to show. Is ignored if `feature_names` is passed.</span>
<span class="sd">        groupby: Which key to group the features by.</span>
<span class="sd">        feature_symbols: Key for field in `.var` that stores feature symbols if you do not want to</span>
<span class="sd">                         use `.var_names` displayed in the plot.</span>
<span class="sd">        values_to_plot: Key to plot. One of &#39;scores&#39;, &#39;logfoldchanges&#39;, &#39;pvals&#39;, &#39;pvalds_adj&#39;,</span>
<span class="sd">                        &#39;log10_pvals&#39;, &#39;log10_pvalds_adj&#39;.</span>
<span class="sd">        var_names: Feature names.</span>
<span class="sd">        min_logfoldchange: Minimum log fold change to consider.</span>
<span class="sd">        key: The key of the calculated feature group rankings (default: &#39;rank_features_groups&#39;).</span>
<span class="sd">        show: Whether to show the plot.</span>
<span class="sd">        save: Where to save the plot.</span>
<span class="sd">        return_fig: Returns :class:`StackedViolin` object. Useful for fine-tuning the plot.</span>
<span class="sd">                    Takes precedence over `show=False`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        If `return_fig` is `True`, returns a :class:`MatrixPlot` object,</span>
<span class="sd">        else if `show` is false, return axes dict</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.5, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.tl.rank_features_groups(adata, groupby=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.rank_features_groups_matrixplot(adata, key=&quot;rank_features_groups&quot;, groupby=&quot;leiden_0_5&quot;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/rank_features_groups_matrixplot.png</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">rank_genes_groups_matrixplot</span><span class="p">(</span>
        <span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span>
        <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span>
        <span class="n">n_genes</span><span class="o">=</span><span class="n">n_features</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">,</span>
        <span class="n">values_to_plot</span><span class="o">=</span><span class="n">values_to_plot</span><span class="p">,</span>
        <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
        <span class="n">gene_symbols</span><span class="o">=</span><span class="n">feature_symbols</span><span class="p">,</span>
        <span class="n">min_logfoldchange</span><span class="o">=</span><span class="n">min_logfoldchange</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="n">return_fig</span><span class="o">=</span><span class="n">return_fig</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="rank_features_groups_tracksplot"><a class="viewcode-back" href="../../../usage/plot/ehrapy.plot.rank_features_groups_tracksplot.html#ehrapy.plot.rank_features_groups_tracksplot">[docs]</a><span class="k">def</span> <span class="nf">rank_features_groups_tracksplot</span><span class="p">(</span>
    <span class="n">adata</span><span class="p">:</span> <span class="n">AnnData</span><span class="p">,</span>
    <span class="n">groups</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">groupby</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">var_names</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_logfoldchange</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pragma: no cover</span>
    <span class="sd">&quot;&quot;&quot;Plot ranking of genes using tracksplot plot (see :func:`~ehrapy.pl.tracksplot`)</span>

<span class="sd">    Args:</span>
<span class="sd">        adata: Annotated data matrix.</span>
<span class="sd">        groups: List of group names.</span>
<span class="sd">        n_features: Number of features to show. Is ignored if `feature_names` is passed.</span>
<span class="sd">        groupby: Which key to group the features by.</span>
<span class="sd">        feature_symbols: Key for field in `.var` that stores feature symbols if you do not want to</span>
<span class="sd">                         use `.var_names` displayed in the plot.</span>
<span class="sd">        var_names: Feature names.</span>
<span class="sd">        min_logfoldchange: Minimum log fold change to consider.</span>
<span class="sd">        key: The key of the calculated feature group rankings (default: &#39;rank_features_groups&#39;).</span>
<span class="sd">        show: Whether to show the plot.</span>
<span class="sd">        save: Where to save the plot.</span>

<span class="sd">    Example:</span>
<span class="sd">        .. code-block:: python</span>

<span class="sd">            import ehrapy as ep</span>

<span class="sd">            adata = ep.data.mimic_2(encoded=True)</span>
<span class="sd">            ep.pp.knn_impute(adata)</span>
<span class="sd">            ep.pp.norm_log(adata, offset=1)</span>
<span class="sd">            ep.pp.neighbors(adata)</span>
<span class="sd">            ep.tl.leiden(adata, resolution=0.15, key_added=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.tl.rank_features_groups(adata, groupby=&quot;leiden_0_5&quot;)</span>
<span class="sd">            ep.pl.rank_features_groups_tracksplot(adata, key=&quot;rank_features_groups&quot;)</span>

<span class="sd">    Preview:</span>
<span class="sd">        .. image:: /_static/docstring_previews/rank_features_groups_tracksplot.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">rank_genes_groups_tracksplot</span><span class="p">(</span>
        <span class="n">adata</span><span class="o">=</span><span class="n">adata</span><span class="p">,</span>
        <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">,</span>
        <span class="n">n_genes</span><span class="o">=</span><span class="n">n_features</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="n">groupby</span><span class="p">,</span>
        <span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span>
        <span class="n">feature_symbols</span><span class="o">=</span><span class="n">feature_symbols</span><span class="p">,</span>
        <span class="n">min_logfoldchange</span><span class="o">=</span><span class="n">min_logfoldchange</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
        <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwds</span><span class="p">,</span>
    <span class="p">)</span></div>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2021, Lukas Heumos, Theislab
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>